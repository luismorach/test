{"ast":null,"code":"import { FormControl } from '@angular/forms';\nimport { DinamicInput } from 'src/app/utils/DinamicInput';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/router\";\nimport * as i2 from \"src/app/services/comunicator/comunicator-componets.service\";\nimport * as i3 from \"../../ventas/service/ventas.service\";\nimport * as i4 from \"../../administracion/usuarios/service/usuarios.service\";\nimport * as i5 from \"../../productos/productos-en-almacen/service/productos.service\";\nimport * as i6 from \"@angular/forms\";\nimport * as i7 from \"@angular/common\";\nimport * as i8 from \"../../devoluciones/service/devoluciones.service\";\nconst _c0 = [\"quantity\"];\nconst _c1 = [\"popup\"];\nfunction DetallesVentaComponent_button_84_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r4 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"button\", 27);\n    i0.ɵɵlistener(\"click\", function DetallesVentaComponent_button_84_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r4);\n      const ctx_r3 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r3.cancel(ctx_r3.popUp));\n    });\n    i0.ɵɵtext(1, \" \\u00A0\\u00A0CANCELAR\");\n    i0.ɵɵelementEnd();\n  }\n}\nconst _c2 = function (a0, a1) {\n  return {\n    \"input-on-focus-success\": a0,\n    \"input-on-focus-fail\": a1\n  };\n};\nconst _c3 = function (a0, a1) {\n  return {\n    \"label-on-focus-down\": a0,\n    \"label-on-focus-up\": a1\n  };\n};\nconst _c4 = function (a0) {\n  return {\n    \"enable aceptar\": a0\n  };\n};\nexport class DetallesVentaComponent extends DinamicInput {\n  constructor(routes, comunicatorSvc, renderer, route, ventasSvc, usuariosSvc, productosSvc, fb, location, devolucionesSvc) {\n    super();\n    this.routes = routes;\n    this.comunicatorSvc = comunicatorSvc;\n    this.renderer = renderer;\n    this.route = route;\n    this.ventasSvc = ventasSvc;\n    this.usuariosSvc = usuariosSvc;\n    this.productosSvc = productosSvc;\n    this.fb = fb;\n    this.location = location;\n    this.devolucionesSvc = devolucionesSvc;\n    this.title = [];\n    this.sell_products = [];\n    this.repayments = [];\n    this.products = [];\n  }\n  ngOnInit() {\n    setTimeout(() => {\n      /* Obtengo la ruta actual y la transformo para obtener el titulo del componente*/\n      this.ruta = this.routes.url.slice(this.routes.url.slice(1).indexOf('/') + 2, this.routes.url.lastIndexOf('?'));\n      this.title.push(\"fas fa-coins fa-fw\"); //aañado el icono del titulo al array\n      this.title.push(decodeURI(this.ruta).toUpperCase()); //añado el titulo al array\n      this.comunicatorSvc.setTitleComponent(this.title);\n    });\n    this.route.queryParams.subscribe(params => {\n      this.ventasSvc.getSell(params['id_sell']).subscribe(res => {\n        console.log(res);\n        let aux = res;\n        this.sell = aux;\n        console.log('venta');\n        console.log(this.sell);\n      });\n    });\n    this.formDevolucion = this.fb.group({\n      quantity_back: new FormControl('')\n    });\n  }\n  showModal(product, index) {\n    this.indexElementToBack = index;\n    this.renderer.setProperty(this.quantityBack?.nativeElement.children[0].children[0], 'textContent', 'Realizar Devolución (' + product.name + ' ' + product.mark + ' ' + product.model + ')');\n    this.quantityBack?.nativeElement.showModal();\n  }\n  calcularPromedio(price) {\n    return (this.products[this.indexElementToBack].sell_price * this.products[this.indexElementToBack].exist_quantity - this.sell_products[this.indexElementToBack].sell_price * Number(this.formDevolucion.get('quantity_back')?.value)) / (this.products[this.indexElementToBack].exist_quantity - Number(this.formDevolucion.get('quantity_back')?.value));\n  }\n  registrarDevolucion() {\n    let content = '';\n    if (Number(this.formDevolucion.get('quantity_back')?.value) > this.sell_products[this.indexElementToBack].quantity_products - this.sell_products[this.indexElementToBack].quantity_back) {\n      content = 'La cantidad a devolver es mayor a la registrada en la compra';\n    } else if (this.products[this.indexElementToBack].exist_quantity - Number(this.formDevolucion.get('quantity_back')?.value) < 0) {\n      content = 'No existe esa cantidad en el almacen, los productos ya han sido vendidos';\n    } else {\n      let repayment = {\n        type: 'compra',\n        date: new Date(),\n        id_operation: this.sell_products[this.indexElementToBack].id_sell,\n        quantity: Number(this.formDevolucion.get('quantity_back')?.value),\n        price: this.sell_products[this.indexElementToBack].sell_price,\n        total: Number(this.formDevolucion.get('quantity_back')?.value) * this.sell_products[this.indexElementToBack].sell_price,\n        coin: this.sell.coin,\n        exist_quantity: this.products[this.indexElementToBack].exist_quantity - Number(this.formDevolucion.get('quantity_back')?.value),\n        weighted_averages: Number(((this.products[this.indexElementToBack].sell_price * this.products[this.indexElementToBack].exist_quantity - this.comunicatorSvc.converterToMainCoin(this.sell_products[this.indexElementToBack].sell_price, this.sell.exchange) * Number(this.formDevolucion.get('quantity_back')?.value)) / (this.products[this.indexElementToBack].exist_quantity - Number(this.formDevolucion.get('quantity_back')?.value))).toFixed(2)),\n        id_user: this.sell.id_user,\n        id_product: this.sell_products[this.indexElementToBack].id_product\n      };\n      repayment.weighted_averages = isNaN(repayment.weighted_averages) ? 0 : repayment.weighted_averages;\n      repayment.weighted_averages = this.comunicatorSvc.converterToSecondaryCoin(repayment.weighted_averages, this.sell.exchange);\n      this.devolucionesSvc.setRepayment(repayment).subscribe(res => {\n        if (res.title.includes('Registrada')) {\n          this.repayments.push(repayment);\n          this.sell_products[this.indexElementToBack].quantity_back += Number(this.formDevolucion.get('quantity_back')?.value);\n          this.sell.total_sell -= Number(this.formDevolucion.get('quantity_back')?.value) * this.sell_products[this.indexElementToBack].sell_price;\n          this.products[this.indexElementToBack].sell_price = this.comunicatorSvc.converterToMainCoin(repayment.weighted_averages, this.sell.exchange);\n          this.products[this.indexElementToBack].sell_price = Number(((this.products[this.indexElementToBack].sell_price * this.products[this.indexElementToBack].exist_quantity - this.comunicatorSvc.converterToMainCoin(this.sell_products[this.indexElementToBack].sell_price, this.sell.exchange) * Number(this.formDevolucion.get('quantity_back')?.value)) / (this.products[this.indexElementToBack].exist_quantity - Number(this.formDevolucion.get('quantity_back')?.value))).toFixed(2));\n          this.products[this.indexElementToBack].exist_quantity = repayment.exist_quantity;\n          console.log(this.products[this.indexElementToBack].sell_price);\n          this.products[this.indexElementToBack].sell_price = this.products[this.indexElementToBack].exist_quantity === 0 ? 0 : this.products[this.indexElementToBack].sell_price;\n          this.ventasSvc.updateSell(this.sell_products[this.indexElementToBack].id_sell, this.sell).subscribe(res => console.log(res));\n          this.ventasSvc.updateProductsSell(this.sell_products[this.indexElementToBack].id_sell, this.sell_products[this.indexElementToBack].id_product, this.sell_products[this.indexElementToBack]).subscribe(res => console.log(res));\n          this.productosSvc.updateProducto(this.products[this.indexElementToBack].id_product, this.products[this.indexElementToBack]).subscribe(res => console.log(res));\n        }\n        console.log(res);\n        this.changeModal(res);\n        this.popUp?.nativeElement.showModal();\n      });\n    }\n    if (content !== '') {\n      let values = {\n        icon: 'fa-regular fa-circle-xmark',\n        title: 'Ocurrió un error inesperado',\n        content: content\n      };\n      this.changeModal(values);\n      this.popUp?.nativeElement.showModal();\n    }\n  }\n  calcularTotal() {\n    this.quantityBack?.nativeElement;\n    let total = 0;\n    this.sell_products.forEach(sell_product => {\n      total += sell_product.sell_price * sell_product.quantity_products;\n    });\n    return total;\n  }\n  redirectToVentasRealizadas() {\n    this.location.back();\n  }\n  product(repayment) {\n    let name_product = '';\n    this.products.forEach(product => {\n      if (product.id_product === repayment.id_product) {\n        name_product = product.name + ' ' + product.mark + ' ' + product.model;\n      }\n    });\n    return name_product;\n  }\n  acept() {\n    if (this.popUp?.nativeElement.children[1].textContent === 'Ocurrió un error inesperado') {\n      this.cancel(this.popUp);\n    } else {\n      this.cancel(this.popUp);\n      this.cancel(this.quantityBack);\n    }\n  }\n}\nDetallesVentaComponent.ɵfac = function DetallesVentaComponent_Factory(t) {\n  return new (t || DetallesVentaComponent)(i0.ɵɵdirectiveInject(i1.Router), i0.ɵɵdirectiveInject(i2.ComunicatorComponetsService), i0.ɵɵdirectiveInject(i0.Renderer2), i0.ɵɵdirectiveInject(i1.ActivatedRoute), i0.ɵɵdirectiveInject(i3.VentasService), i0.ɵɵdirectiveInject(i4.UsuariosService), i0.ɵɵdirectiveInject(i5.ProductosService), i0.ɵɵdirectiveInject(i6.FormBuilder), i0.ɵɵdirectiveInject(i7.Location), i0.ɵɵdirectiveInject(i8.DevolucionesService));\n};\nDetallesVentaComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: DetallesVentaComponent,\n  selectors: [[\"app-detalles-venta\"]],\n  viewQuery: function DetallesVentaComponent_Query(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵviewQuery(_c0, 7);\n      i0.ɵɵviewQuery(_c1, 7);\n    }\n    if (rf & 2) {\n      let _t;\n      i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.quantityBack = _t.first);\n      i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.popUp = _t.first);\n    }\n  },\n  features: [i0.ɵɵInheritDefinitionFeature],\n  decls: 85,\n  vars: 16,\n  consts: [[1, \"form-container\"], [1, \"datos\"], [1, \"form-button\", \"btn-save\", 3, \"click\"], [1, \"fas\", \"fa-reply\"], [1, \"table-container\"], [1, \"table-title\"], [1, \"table-body\"], [1, \"table-responsive\"], [1, \"table\", \"table-bordered\"], [1, \"quantity\"], [\"quantity\", \"\"], [1, \"header\"], [1, \"title\"], [1, \"btn-cerrar-dialog\", 3, \"click\"], [1, \"form\", 3, \"formGroup\"], [1, \"form-control\", 3, \"ngClass\"], [1, \"form-label\", 3, \"ngClass\", \"ngStyle\"], [\"formControlName\", \"quantity_back\", 1, \"form-input\", 3, \"ngStyle\", \"focus\", \"focusout\", \"keypress\"], [1, \"form-actions\"], [1, \"form-button\", \"btn\", 3, \"ngClass\", \"click\"], [1, \"fas\", \"fa-truck-loading\", \"fa-fw\"], [1, \"form-button\", \"btn\", \"enable\", 2, \"color\", \"#f44336\", 3, \"click\"], [1, \"far\", \"fa-times-circle\"], [1, \"dialog\"], [\"popup\", \"\"], [1, \"fa-regular\", \"fa-circle-question\"], [\"class\", \"form-button btn-cancel\", 3, \"click\", 4, \"ngIf\"], [1, \"form-button\", \"btn-cancel\", 3, \"click\"]],\n  template: function DetallesVentaComponent_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵelementStart(0, \"div\", 0)(1, \"div\", 1)(2, \"button\", 2);\n      i0.ɵɵlistener(\"click\", function DetallesVentaComponent_Template_button_click_2_listener() {\n        return ctx.redirectToVentasRealizadas();\n      });\n      i0.ɵɵelement(3, \"i\", 3);\n      i0.ɵɵtext(4, \" \\u00A0Regresar\");\n      i0.ɵɵelementEnd()();\n      i0.ɵɵelementStart(5, \"div\", 4)(6, \"div\", 5)(7, \"h6\");\n      i0.ɵɵtext(8, \"productos vendidos\");\n      i0.ɵɵelementEnd()();\n      i0.ɵɵelementStart(9, \"div\", 6)(10, \"div\", 7)(11, \"table\", 8)(12, \"thead\")(13, \"tr\")(14, \"th\");\n      i0.ɵɵtext(15, \"N\\u00B0\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(16, \"th\");\n      i0.ɵɵtext(17, \"C\\u00F3digo de barra\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(18, \"th\");\n      i0.ɵɵtext(19, \"Producto\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(20, \"th\");\n      i0.ɵɵtext(21, \"Cantidad\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(22, \"th\");\n      i0.ɵɵtext(23, \"Precio de compra\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(24, \"th\");\n      i0.ɵɵtext(25, \"Sub total\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(26, \"th\");\n      i0.ɵɵtext(27, \"Devoluci\\u00F3n\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(28, \"th\");\n      i0.ɵɵtext(29);\n      i0.ɵɵelementEnd()()()()()()();\n      i0.ɵɵelementStart(30, \"div\", 4)(31, \"div\", 5)(32, \"h6\");\n      i0.ɵɵtext(33, \"Devoluciones realizadas\");\n      i0.ɵɵelementEnd()();\n      i0.ɵɵelementStart(34, \"div\", 6)(35, \"div\", 7)(36, \"table\", 8)(37, \"thead\")(38, \"tr\")(39, \"th\");\n      i0.ɵɵtext(40, \"N\\u00B0\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(41, \"th\");\n      i0.ɵɵtext(42, \"Fecha\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(43, \"th\");\n      i0.ɵɵtext(44, \"Producto\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(45, \"th\");\n      i0.ɵɵtext(46, \"Cantidad\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(47, \"th\");\n      i0.ɵɵtext(48, \"Precio de compra\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(49, \"th\");\n      i0.ɵɵtext(50, \"Total\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(51, \"th\");\n      i0.ɵɵtext(52, \"Vendedor\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(53, \"th\");\n      i0.ɵɵtext(54, \"caja\");\n      i0.ɵɵelementEnd()()()()()()()();\n      i0.ɵɵelementStart(55, \"dialog\", 9, 10)(57, \"div\", 11)(58, \"h2\", 12);\n      i0.ɵɵtext(59, \"Realizar devoluci\\u00F3n\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(60, \"button\", 13);\n      i0.ɵɵlistener(\"click\", function DetallesVentaComponent_Template_button_click_60_listener() {\n        return ctx.cancel(ctx.quantityBack);\n      });\n      i0.ɵɵtext(61, \"x\");\n      i0.ɵɵelementEnd()();\n      i0.ɵɵelementStart(62, \"div\", 14)(63, \"div\", 15)(64, \"label\", 16);\n      i0.ɵɵtext(65, \" Cantidad a devolver \");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(66, \"input\", 17);\n      i0.ɵɵlistener(\"focus\", function DetallesVentaComponent_Template_input_focus_66_listener() {\n        return ctx.isFocused(7, ctx.formDevolucion, \"quantity_back\");\n      })(\"focusout\", function DetallesVentaComponent_Template_input_focusout_66_listener() {\n        return ctx.isFocused(7, ctx.formDevolucion, \"quantity_back\");\n      })(\"keypress\", function DetallesVentaComponent_Template_input_keypress_66_listener($event) {\n        return ctx.validate($event, false);\n      });\n      i0.ɵɵelementEnd()()();\n      i0.ɵɵelementStart(67, \"div\", 18)(68, \"button\", 19);\n      i0.ɵɵlistener(\"click\", function DetallesVentaComponent_Template_button_click_68_listener() {\n        return ctx.registrarDevolucion();\n      });\n      i0.ɵɵelement(69, \"i\", 20);\n      i0.ɵɵtext(70, \" \\u00A0\\u00A0REALIZAR DEVOLUCI\\u00D3N\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(71, \"button\", 21);\n      i0.ɵɵlistener(\"click\", function DetallesVentaComponent_Template_button_click_71_listener() {\n        return ctx.cancel(ctx.quantityBack);\n      });\n      i0.ɵɵelement(72, \"i\", 22);\n      i0.ɵɵtext(73, \" \\u00A0\\u00A0CANCELAR\");\n      i0.ɵɵelementEnd()()();\n      i0.ɵɵelementStart(74, \"dialog\", 23, 24);\n      i0.ɵɵelement(76, \"i\", 25);\n      i0.ɵɵelementStart(77, \"h3\");\n      i0.ɵɵtext(78, \"\\u00BFEstas seguro?\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(79, \"p\");\n      i0.ɵɵtext(80, \"Lois datos seran guardados en el sistema\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(81, \"div\")(82, \"button\", 2);\n      i0.ɵɵlistener(\"click\", function DetallesVentaComponent_Template_button_click_82_listener() {\n        return ctx.acept();\n      });\n      i0.ɵɵtext(83, \" \\u00A0\\u00A0ACEPTAR\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵtemplate(84, DetallesVentaComponent_button_84_Template, 2, 0, \"button\", 26);\n      i0.ɵɵelementEnd()();\n    }\n    if (rf & 2) {\n      let tmp_6_0;\n      i0.ɵɵadvance(29);\n      i0.ɵɵtextInterpolate(ctx.sell.id_sell);\n      i0.ɵɵadvance(33);\n      i0.ɵɵproperty(\"formGroup\", ctx.formDevolucion);\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngClass\", i0.ɵɵpureFunction2(8, _c2, ctx.verifyStyleInput(ctx.formDevolucion, \"quantity_back\") && ctx.elementHasFocus[7], !ctx.verifyStyleInput(ctx.formDevolucion, \"quantity_back\")));\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngClass\", i0.ɵɵpureFunction2(11, _c3, ctx.elementHasFocus[7] && ctx.positionLabel[7], ctx.elementHasFocus[7] && !ctx.positionLabel[7]))(\"ngStyle\", ctx.animationLabel(ctx.formDevolucion, \"quantity_back\"));\n      i0.ɵɵadvance(2);\n      i0.ɵɵproperty(\"ngStyle\", ctx.styleForeground(ctx.formDevolucion, \"quantity_back\"));\n      i0.ɵɵadvance(2);\n      i0.ɵɵproperty(\"ngClass\", i0.ɵɵpureFunction1(14, _c4, ((tmp_6_0 = ctx.formDevolucion.get(\"quantity_back\")) == null ? null : tmp_6_0.value.length) > 0));\n      i0.ɵɵadvance(16);\n      i0.ɵɵproperty(\"ngIf\", (ctx.popUp == null ? null : ctx.popUp.nativeElement.children[1].textContent) === \"\\u00BFEst\\u00E1s seguro?\");\n    }\n  },\n  dependencies: [i7.NgClass, i7.NgIf, i7.NgStyle, i6.DefaultValueAccessor, i6.NgControlStatus, i6.NgControlStatusGroup, i6.FormGroupDirective, i6.FormControlName],\n  styles: [\"\\n/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IiIsInNvdXJjZVJvb3QiOiIifQ== */\"]\n});","map":{"version":3,"mappings":"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","names":["FormControl","DinamicInput","i0","DetallesVentaComponent","constructor","routes","comunicatorSvc","renderer","route","ventasSvc","usuariosSvc","productosSvc","fb","location","devolucionesSvc","ngOnInit","setTimeout","ruta","url","slice","indexOf","lastIndexOf","title","push","decodeURI","toUpperCase","setTitleComponent","queryParams","subscribe","params","getSell","res","console","log","aux","sell","formDevolucion","group","quantity_back","showModal","product","index","indexElementToBack","setProperty","quantityBack","nativeElement","children","name","mark","model","calcularPromedio","price","products","sell_price","exist_quantity","sell_products","Number","get","value","registrarDevolucion","content","quantity_products","repayment","type","date","Date","id_operation","id_sell","quantity","total","coin","weighted_averages","converterToMainCoin","exchange","toFixed","id_user","id_product","isNaN","converterToSecondaryCoin","setRepayment","includes","repayments","total_sell","updateSell","updateProductsSell","updateProducto","changeModal","popUp","values","icon","calcularTotal","forEach","sell_product","redirectToVentasRealizadas","back","name_product","acept","textContent","cancel","selectors","viewQuery","ctx"],"sourceRoot":"","sources":["/home/luis/Documentos/systems vs code/inventary-system/client/src/app/content/ventas/detalles-venta/detalles-venta.component.ts","/home/luis/Documentos/systems vs code/inventary-system/client/src/app/content/ventas/detalles-venta/detalles-venta.component.html"],"sourcesContent":["import { Component, ElementRef, Renderer2, ViewChild } from '@angular/core';\nimport { FormBuilder, FormControl, FormGroup } from '@angular/forms';\nimport { ActivatedRoute, Router } from '@angular/router';\nimport { product, repayment, sell, sell_product, user,alert } from 'src/app/interfaces/interfaces';\nimport { ComunicatorComponetsService } from 'src/app/services/comunicator/comunicator-componets.service';\nimport { DinamicInput } from 'src/app/utils/DinamicInput';\nimport { VentasService } from '../../ventas/service/ventas.service';\nimport { UsuariosService } from '../../administracion/usuarios/service/usuarios.service';\nimport { ProductosService } from '../../productos/productos-en-almacen/service/productos.service';\nimport { DevolucionesService } from '../../devoluciones/service/devoluciones.service';\nimport { Location } from '@angular/common';\n\n@Component({\n  selector: 'app-detalles-venta',\n  templateUrl: './detalles-venta.component.html',\n  styleUrls: ['./detalles-venta.component.css']\n})\nexport class DetallesVentaComponent extends DinamicInput {\n\n  ruta!: string\n  title: string[] = []\n  sell!: sell\n  user!: user\n  sell_products: sell_product[] = []\n  repayments: repayment[] = []\n  products: product[] = []\n  indexElementToBack!: number\n  formDevolucion!: FormGroup\n  @ViewChild('quantity', { static: true }) quantityBack?: ElementRef;\n  @ViewChild('popup', { static: true }) override popUp?: ElementRef;\n\n  constructor(private routes: Router,\n    private comunicatorSvc: ComunicatorComponetsService,\n    public override renderer: Renderer2,\n    private route: ActivatedRoute,\n    private ventasSvc: VentasService,\n    private usuariosSvc: UsuariosService,\n    private productosSvc: ProductosService,\n    private fb: FormBuilder,\n    private location: Location,\n    private devolucionesSvc: DevolucionesService) {\n    super()\n  }\n\n  ngOnInit() {\n    setTimeout(() => {\n      /* Obtengo la ruta actual y la transformo para obtener el titulo del componente*/\n      this.ruta = this.routes.url.slice((this.routes.url.slice(1).indexOf('/')) + 2, this.routes.url.lastIndexOf('?'));\n      this.title.push(\"fas fa-coins fa-fw\");//aañado el icono del titulo al array\n      this.title.push(decodeURI(this.ruta).toUpperCase());//añado el titulo al array\n      this.comunicatorSvc.setTitleComponent(this.title);\n    });\n    this.route.queryParams.subscribe((params) => {\n      this.ventasSvc.getSell(params['id_sell']).subscribe(res => {\n        console.log(res)\n        let aux:any=res\n        this.sell=aux\n        console.log('venta')\n        console.log(this.sell)\n      })\n    })\n    this.formDevolucion = this.fb.group({\n      quantity_back: new FormControl('')\n    })\n  }\n  showModal(product: product, index: number) {\n    this.indexElementToBack = index\n    this.renderer.setProperty(this.quantityBack?.nativeElement.children[0].children[0],\n      'textContent', 'Realizar Devolución (' + product.name + ' ' + product.mark + ' ' + product.model + ')')\n    this.quantityBack?.nativeElement.showModal()\n  }\n  calcularPromedio(price: number) {\n    return ((this.products[this.indexElementToBack].sell_price *\n      this.products[this.indexElementToBack].exist_quantity) -\n      (this.sell_products[this.indexElementToBack].sell_price *\n        Number(this.formDevolucion.get('quantity_back')?.value))) /\n      (this.products[this.indexElementToBack].exist_quantity -\n        Number(this.formDevolucion.get('quantity_back')?.value))\n  }\n  registrarDevolucion() {\n    let content = ''\n    if (Number(this.formDevolucion.get('quantity_back')?.value) >\n      (this.sell_products[this.indexElementToBack].quantity_products -\n        this.sell_products[this.indexElementToBack].quantity_back)) {\n      content = 'La cantidad a devolver es mayor a la registrada en la compra'\n    } else if ((this.products[this.indexElementToBack].exist_quantity -\n      Number(this.formDevolucion.get('quantity_back')?.value)) < 0) {\n      content = 'No existe esa cantidad en el almacen, los productos ya han sido vendidos'\n    } else {\n      let repayment: repayment = {\n        type: 'compra',\n        date: new Date(),\n        id_operation: this.sell_products[this.indexElementToBack].id_sell,\n        quantity: Number(this.formDevolucion.get('quantity_back')?.value),\n        price: this.sell_products[this.indexElementToBack].sell_price,\n        total: Number(this.formDevolucion.get('quantity_back')?.value) *\n          this.sell_products[this.indexElementToBack].sell_price,\n        coin: this.sell.coin,\n        exist_quantity: this.products[this.indexElementToBack].exist_quantity - Number(this.formDevolucion.get('quantity_back')?.value),\n        weighted_averages: Number((((this.products[this.indexElementToBack].sell_price *\n          this.products[this.indexElementToBack].exist_quantity) -\n          (this.comunicatorSvc.converterToMainCoin(this.sell_products[this.indexElementToBack].sell_price, this.sell.exchange) *\n            Number(this.formDevolucion.get('quantity_back')?.value))) /\n          (this.products[this.indexElementToBack].exist_quantity -\n            Number(this.formDevolucion.get('quantity_back')?.value))).toFixed(2)),\n        id_user: this.sell.id_user,\n        id_product: this.sell_products[this.indexElementToBack].id_product,\n      }\n      repayment.weighted_averages = (isNaN(repayment.weighted_averages)) ? 0 : repayment.weighted_averages\n      repayment.weighted_averages = this.comunicatorSvc.converterToSecondaryCoin(repayment.weighted_averages, this.sell.exchange)\n      this.devolucionesSvc.setRepayment(repayment).subscribe(res => {\n        if (res.title.includes('Registrada')) {\n          this.repayments.push(repayment)\n          this.sell_products[this.indexElementToBack].quantity_back += Number(this.formDevolucion.get('quantity_back')?.value)\n          this.sell.total_sell -= (Number(this.formDevolucion.get('quantity_back')?.value) *\n            this.sell_products[this.indexElementToBack].sell_price)\n          this.products[this.indexElementToBack].sell_price = this.comunicatorSvc.converterToMainCoin(\n            repayment.weighted_averages, this.sell.exchange)\n\n          this.products[this.indexElementToBack].sell_price =\n            Number((((this.products[this.indexElementToBack].sell_price *\n              this.products[this.indexElementToBack].exist_quantity) -\n              (this.comunicatorSvc.converterToMainCoin(this.sell_products[this.indexElementToBack].sell_price, this.sell.exchange) *\n                Number(this.formDevolucion.get('quantity_back')?.value))) /\n              (this.products[this.indexElementToBack].exist_quantity -\n                Number(this.formDevolucion.get('quantity_back')?.value))).toFixed(2))\n          this.products[this.indexElementToBack].exist_quantity = repayment.exist_quantity\n          console.log(this.products[this.indexElementToBack].sell_price)\n          this.products[this.indexElementToBack].sell_price = (\n            this.products[this.indexElementToBack].exist_quantity === 0) ? 0 : this.products[this.indexElementToBack].sell_price\n          this.ventasSvc.updateSell(this.sell_products[this.indexElementToBack].id_sell, this.sell).subscribe(\n            res => console.log(res)\n          )\n          this.ventasSvc.updateProductsSell(this.sell_products[this.indexElementToBack].id_sell,\n            this.sell_products[this.indexElementToBack].id_product, this.sell_products[this.indexElementToBack]).subscribe(\n              res => console.log(res)\n            )\n          this.productosSvc.updateProducto(this.products[this.indexElementToBack].id_product,\n            this.products[this.indexElementToBack]).subscribe(res => console.log(res))\n        }\n        console.log(res)\n        this.changeModal(res)\n        this.popUp?.nativeElement.showModal()\n      })\n    }\n    if (content !== '') {\n      let values: alert = {\n        icon: 'fa-regular fa-circle-xmark',\n        title: 'Ocurrió un error inesperado',\n        content: content\n      }\n      this.changeModal(values)\n      this.popUp?.nativeElement.showModal()\n    }\n  }\n\n  calcularTotal() {\n    this.quantityBack?.nativeElement\n    let total = 0;\n    this.sell_products.forEach((sell_product: sell_product) => {\n      total += sell_product.sell_price * sell_product.quantity_products\n    })\n    return total\n  }\n  redirectToVentasRealizadas() {\n    this.location.back()\n  }\n  product(repayment: repayment) {\n    let name_product = ''\n    this.products.forEach((product: product) => {\n      if (product.id_product === repayment.id_product) {\n        name_product = product.name + ' ' + product.mark + ' ' + product.model\n      }\n    })\n    return name_product\n  }\n  acept() {\n    if (this.popUp?.nativeElement.children[1].textContent === 'Ocurrió un error inesperado') {\n      this.cancel(this.popUp)\n    } else {\n      this.cancel(this.popUp)\n      this.cancel(this.quantityBack)\n    }\n  }\n}\n","<div class=\"form-container\">\n    <div class=\"datos\">\n        <button (click)=\"redirectToVentasRealizadas()\"\n         class=\"form-button btn-save\"><i class=\"fas fa-reply\"></i> &nbsp;Regresar</button>\n    </div>\n    <div class=\"table-container\">\n        <div class=\"table-title\">\n            <h6>productos vendidos</h6>\n        </div>\n        <div class=\"table-body\">\n            <div class=\"table-responsive\">\n                <table class=\"table table-bordered\">\n                    <thead>\n                        <tr>\n                            <th>N°</th>\n                            <th>Código de barra</th>\n                            <th>Producto</th>\n                            <th>Cantidad</th>\n                            <th>Precio de compra</th>\n                            <th>Sub total</th>\n                            <th>Devolución</th>\n                            <th>{{sell.id_sell}}</th>\n                        </tr>\n                    </thead>\n\n                    <!-- <tbody #tab>\n                        <tr *ngFor=\"let buy_product of buy_products; let i=index\">\n                            <td>{{i+1}}</td>\n                            <td *ngIf=\"products[i]!=undefined\">{{products[i].barcode}}</td>\n                            <td *ngIf=\"products[i]!=undefined\">\n                                {{products[i].name}}&nbsp;{{products[i].mark}}&nbsp;{{products[i].model}}&nbsp;</td>\n                            <td>{{buy_product.quantity_products}} </td>\n                            <td>{{buy_product.buy_price|currency:buy.coin+' '}}</td>\n                            <td>{{buy_product.quantity_products*buy_product.buy_price|currency:buy.coin+' '}}</td>\n                            <td class=\"icon\" (click)=\"showModal(products[i],i)\">\n                                <i class=\"fas fa-truck-loading fa-fw\" style=\"color:#009688\"></i>\n                            </td>\n                        </tr>\n                     <tr *ngIf=\"buy_products.length>0\">\n                        <td></td>\n                        <td></td>\n                        <td></td>\n                        <td></td>\n                        <td><strong>Total</strong></td>\n                        <td>{{calcularTotal()|currency:buy.coin+' '}}</td>\n                        <td></td>\n                    </tr>\n                    </tbody> -->\n                </table>\n            </div>\n        </div>\n    </div>\n    <div class=\"table-container\">\n        <div class=\"table-title\">\n            <h6>Devoluciones realizadas</h6>\n        </div>\n        <div class=\"table-body\">\n            <div class=\"table-responsive\">\n                <table class=\"table table-bordered\">\n                    <thead>\n                        <tr>\n                            <th>N°</th>\n                            <th>Fecha</th>\n                            <th>Producto</th>\n                            <th>Cantidad</th>\n                            <th>Precio de compra</th>\n                            <th>Total</th>\n                            <th>Vendedor</th>\n                            <th>caja</th>\n                        </tr>\n                    </thead>\n\n                    <!-- <tbody #tab>\n                       <tr *ngFor=\"let repayment of repayments; let i=index\">\n                        <td>{{i+1}}</td>\n                        <td>{{repayment.date|date:'dd/MM/yyyy'}}</td>\n                        <td>{{product(repayment)}}</td> \n                        <td>{{repayment.quantity}}</td>\n                        <td>{{repayment.price|currency:repayment.coin+' '}}</td>\n                        <td>{{repayment.total|currency:repayment.coin+' '}}</td>\n                    </tr>\n                        \n                    </tbody> -->\n                </table>\n            </div>\n        </div>\n    </div>\n</div>\n<dialog #quantity class=\"quantity\">\n    <div class=\"header\">\n        <h2 class=\"title\">Realizar devolución</h2>\n        <button class=\"btn-cerrar-dialog\" (click)=\"cancel(quantityBack)\">x</button>\n    </div>\n    <div class=\"form\" [formGroup]=\"formDevolucion\">\n        <div class=\"form-control\" [ngClass]=\"{'input-on-focus-success':verifyStyleInput(formDevolucion,'quantity_back')&&\n    elementHasFocus[7],'input-on-focus-fail':!verifyStyleInput(formDevolucion,'quantity_back')}\">\n            <label class=\"form-label\" [ngClass]=\"{'label-on-focus-down':\nelementHasFocus[7]&&positionLabel[7],\n'label-on-focus-up':\nelementHasFocus[7]&&!positionLabel[7]}\" [ngStyle]=\"animationLabel(formDevolucion,\n'quantity_back')\">\n                Cantidad a devolver\n            </label>\n            <input formControlName=\"quantity_back\"\n                (focus)=\"isFocused(7,formDevolucion,'quantity_back')\"\n                (focusout)=\"isFocused(7,formDevolucion,'quantity_back')\" class=\"form-input\"\n                [ngStyle]=\"styleForeground(formDevolucion,'quantity_back')\"\n                (keypress)=\"validate($event,false)\">\n        </div>\n    </div>\n    <div class=\"form-actions\">\n        <button class=\"form-button btn\"\n            [ngClass]=\"{'enable aceptar':formDevolucion.get('quantity_back')?.value.length>0}\"\n            (click)=\"registrarDevolucion()\">\n           <i class=\"fas fa-truck-loading fa-fw\"></i> &nbsp;&nbsp;REALIZAR DEVOLUCIÓN</button>\n        <button class=\"form-button btn enable\" (click)=\"cancel(quantityBack)\" style=\"color:#f44336\">\n            <i class=\"far fa-times-circle\"></i> &nbsp;&nbsp;CANCELAR</button>\n    </div>\n</dialog>\n<dialog class=\"dialog\" #popup>\n    <i class=\"fa-regular fa-circle-question\"></i>\n    <h3>¿Estas seguro?</h3>\n    <p>Lois datos seran guardados en el sistema</p>\n    <div>\n        <button class=\"form-button btn-save\" (click)=\"acept()\">\n            &nbsp;&nbsp;ACEPTAR</button>\n        <button *ngIf=\"this.popUp?.nativeElement.children[1].textContent === '¿Estás seguro?'\"\n            class=\"form-button btn-cancel\" (click)=\"cancel(popUp)\">\n            &nbsp;&nbsp;CANCELAR</button>\n    </div>\n</dialog>"]},"metadata":{},"sourceType":"module","externalDependencies":[]}