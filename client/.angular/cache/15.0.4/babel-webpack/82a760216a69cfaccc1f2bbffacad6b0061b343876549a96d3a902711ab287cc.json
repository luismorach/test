{"ast":null,"code":"import { __decorate } from \"tslib\";\nimport { Component, ViewChild } from '@angular/core';\nimport { FormControl, FormGroup, Validators } from '@angular/forms';\nimport { DinamicInput } from 'src/app/utils/DinamicInput';\nlet NuevaVentaComponent = class NuevaVentaComponent extends DinamicInput {\n  constructor(fb, routes, comunicatorSvc, productsSvc, coinsSvc, renderer, clientesSvc) {\n    super();\n    this.fb = fb;\n    this.routes = routes;\n    this.comunicatorSvc = comunicatorSvc;\n    this.productsSvc = productsSvc;\n    this.coinsSvc = coinsSvc;\n    this.renderer = renderer;\n    this.clientesSvc = clientesSvc;\n    this.products = [];\n    this.date = new Date();\n    this.coins = [];\n    this.clientes = [];\n    this.pays = [];\n    this.sellProducts = [];\n    this.listProducts = [];\n    this.indexElementToDelete = 0;\n  }\n  ngOnInit() {\n    let title = [];\n    let ruta;\n    setTimeout(() => {\n      /* Obtengo la ruta actual y la transformo para obtener el titulo del componente*/\n      ruta = this.routes.url.slice(this.routes.url.slice(1).indexOf('/') + 2);\n      title.push(\"fas fa-cart-plus fa-fw\"); //aañado el icono del titulo al array\n      title.push(decodeURI(ruta).toUpperCase()); //añado el titulo al array\n      this.comunicatorSvc.setTitleComponent(title);\n    });\n    this.coinsSvc.getCoins().subscribe({\n      next: res => {\n        this.coins = res;\n        res.forEach(coin => {\n          if (coin.type === 'principal') this.coinSelected = coin;\n          this.coinPay = coin;\n        });\n      },\n      complete: () => {\n        this.formNewPay.get('coin')?.setValue(this.coinPay.symbol);\n        this.formNewSell.get('coin')?.setValue(this.coinSelected.symbol);\n      }\n    });\n    this.clientesSvc.getClients().subscribe(clientes => {\n      this.clientes = clientes;\n      clientes.forEach(cliente => {\n        if (cliente.names.includes('Publico')) {\n          this.formNewSell.get('client')?.setValue(cliente.document_number);\n        }\n      });\n    });\n    this.productsSvc.getProductos().subscribe(res => this.listProducts = res);\n    this.formNewSell = this.fb.group({\n      barcode: new FormControl('', [Validators.required, Validators.pattern(/^[0-9]+$/)]),\n      productQuantity: new FormControl('', [Validators.pattern(/^[0-9]+$/)]),\n      client: new FormControl(''),\n      productQuantityBySearch: new FormControl(''),\n      coin: new FormControl(''),\n      discount: new FormControl('', [Validators.pattern(/^[0-9]+$/)])\n    });\n    this.formNewPay = new FormGroup({\n      type: new FormControl('Transacción eléctronica'),\n      coin: new FormControl(''),\n      mount: new FormControl(0),\n      reference: new FormControl()\n    });\n    this.tableSearch = new FormGroup({\n      search: new FormControl()\n    });\n  }\n  selectMoneda() {\n    this.coins.forEach(coin => {\n      if (coin.symbol === this.formNewSell.get('coin')?.value) {\n        this.coinSelected = coin;\n      }\n    });\n  }\n  selectMonedaPay() {\n    this.coins.forEach(coin => {\n      if (coin.symbol === this.formNewPay.get('coin')?.value) {\n        this.coinPay = coin;\n      }\n    });\n  }\n  verificarProductoAñadido(product) {\n    let exist = false;\n    this.products.forEach(producto => {\n      if (producto.name === product.name) {\n        exist = true;\n      } else {\n        exist = false;\n      }\n    });\n    return exist;\n  }\n  addQuantity(product) {\n    let values = {\n      icon: 'fa-regular fa-circle-xmark',\n      title: 'Ocurrió un error inesperado',\n      content: ''\n    };\n    if (this.verificarProductoAñadido(product)) {\n      values.content = 'Este producto ya se encuentra agregado a la venta';\n      this.changeModal(values);\n      this.popUp?.nativeElement.showModal();\n    } else if (product.exist_quantity === 0) {\n      values.content = 'No hay existencias de este producto para vender';\n      this.changeModal(values);\n      this.popUp?.nativeElement.showModal();\n    } else {\n      this.quantityProduct?.nativeElement.showModal();\n      this.product = product;\n    }\n  }\n  open() {\n    this.cliente?.nativeElement.showModal();\n  }\n  receiveMessage(client) {\n    this.clientes.push(client);\n    console.log(this.clientes);\n    console.log(client);\n    this.formNewSell.get('client')?.setValue(client.document_number);\n    this.cancel(this.cliente);\n  }\n  addProduct() {\n    let quantity;\n    if (this.formNewSell.get('productQuantity')?.value === '') {\n      quantity = 1;\n    } else {\n      quantity = this.formNewSell.get('productQuantity')?.value;\n    }\n    if (this.formNewSell.get('barcode')?.valid) {\n      this.productsSvc.getProductoByBarcode(this.formNewSell.get('barcode')?.value).subscribe(product => {\n        if (product instanceof Array) {\n          if (!this.verificarProductoAñadido(product[0])) {\n            this.sellProducts.push({\n              id_sell: 0,\n              id_product: product[0].id_product,\n              buy_price: 0,\n              sell_price: 0,\n              discount_product: 0,\n              impuest: 0,\n              quantity_products: quantity,\n              exist_products: 0,\n              quantity_back: 0\n            });\n            this.products.push(product[0]);\n          }\n        } else {\n          this.changeModal(product);\n          this.popUp?.nativeElement.showModal();\n          this.formNewSell.get('barcode')?.setValue('');\n          this.formNewSell.get('productQuantity')?.setValue('');\n        }\n      });\n    }\n  }\n  addProductBySearch(product) {\n    let quantity = this.formNewSell.get('productQuantityBySearch')?.value;\n    this.sellProducts.push({\n      id_sell: 0,\n      id_product: product.id_product,\n      buy_price: 0,\n      sell_price: 0,\n      discount_product: 0,\n      impuest: 0,\n      quantity_products: quantity,\n      exist_products: 0,\n      quantity_back: 0\n    });\n    this.products.push(product);\n    this.cancel(this.quantityProduct);\n    this.cancel(this.search);\n  }\n  acept(index) {\n    if (this.popUp?.nativeElement.children[1].textContent.includes('error')) {\n      this.popUp?.nativeElement.close();\n    } else if (this.popUp?.nativeElement.children[1].textContent.includes('¿Estás seguro?')) {\n      this.delete(index);\n      this.popUp?.nativeElement.close();\n    } else {\n      this.popUp?.nativeElement.close();\n    }\n  }\n  calcularSubtotal(product, index) {\n    return this.comunicatorSvc.converter(this.products[index].sell_price * this.sellProducts[index].quantity_products - this.products[index].sell_price * this.products[index].discount * this.sellProducts[index].quantity_products, this.coinSelected);\n  }\n  calcularTotal() {\n    let total = 0;\n    this.products.forEach((product, index) => {\n      total += this.products[index].sell_price * this.sellProducts[index].quantity_products - this.products[index].sell_price * this.products[index].discount * this.sellProducts[index].quantity_products;\n    });\n    return this.comunicatorSvc.converter(total, this.coinSelected);\n  }\n  calcularDescuentoVenta() {\n    return Number(this.formNewSell.get('discount')?.value) / 100 * this.calcularTotal();\n  }\n  calcularImpuestoVenta() {\n    let montoImponible = 0;\n    this.products.forEach((product, index) => {\n      if (product.impuest > 0) {\n        montoImponible += product.impuest * (product.sell_price * this.sellProducts[index].quantity_products - product.sell_price * product.discount * this.sellProducts[index].quantity_products);\n      }\n    });\n    return this.comunicatorSvc.converter(montoImponible, this.coinSelected);\n  }\n  total() {\n    return this.calcularTotal() + this.calcularImpuestoVenta() - this.calcularDescuentoVenta();\n  }\n  searchProduct() {\n    this.search?.nativeElement.showModal();\n  }\n  delete(index) {\n    this.products.splice(this.indexElementToDelete, 1);\n    this.sellProducts.splice(this.indexElementToDelete, 1);\n  }\n  validarVenta() {\n    let result = {\n      isValid: false,\n      msj: 'Agrege productos a la venta'\n    };\n    this.products.forEach((product, index) => {\n      if (this.sellProducts[index].quantity_products === 0) {\n        result = {\n          isValid: false,\n          msj: 'La cantidad a vender del producto ' + product.name + 'no puede ser 0'\n        };\n      } else if (this.sellProducts[index].quantity_products > product.exist_quantity) {\n        result = {\n          isValid: false,\n          msj: 'La cantidad a vender del producto ' + product.name + ' es mayor a la existente'\n        };\n      } else {\n        result = {\n          isValid: true,\n          msj: ''\n        };\n      }\n    });\n    return result;\n  }\n  validarPago() {\n    let result = {\n      isValid: true,\n      msj: ''\n    };\n    if (Number(this.formNewPay.get('mount')?.value) === 0) {\n      result = {\n        isValid: false,\n        msj: 'El monto pagado por el cliente no puede ser 0'\n      };\n    } else if (this.formNewPay.get('type')?.value.includes('Transacción')) {\n      if (Number(this.formNewPay.get('mount')?.value) > this.comunicatorSvc.converter(this.total(), this.coinPay)) {\n        result = {\n          isValid: false,\n          msj: 'El monto pagado por el cliente no puede ser mayor al total a pagar'\n        };\n      } else if (this.formNewPay.get('reference')?.value === null) {\n        result = {\n          isValid: false,\n          msj: 'Debe ingresar la referencia del pago realizado'\n        };\n      }\n    }\n    return result;\n  }\n  agregarPago() {\n    this.sell = {\n      id_sell: 0,\n      type: 'venta',\n      total_sell: this.total(),\n      coin: this.coinSelected.symbol,\n      exchange: this.coinSelected.exchange,\n      state: '',\n      type_sell: '',\n      total_pay: 0,\n      discount: this.formNewSell.get('discount')?.value,\n      id_user: 16,\n      id_client: 0\n    };\n    this.pago?.nativeElement.showModal();\n  }\n  registrarPago() {\n    if (this.validarPago().isValid) {\n      let pay = this.formNewPay.value;\n      pay.exchange = this.coinPay.exchange;\n      console.log(pay);\n      this.sell.total_pay += pay.mount;\n      this.pays.push(pay);\n      let msj = {\n        icon: '',\n        title: '¡Pago Registrado!',\n        content: 'El pago se registró  con exito en el sístema'\n      };\n      this.changeModal(msj);\n      this.popUp?.nativeElement.showModal();\n    }\n  }\n};\n__decorate([ViewChild('popup', {\n  static: true\n})], NuevaVentaComponent.prototype, \"popUp\", void 0);\n__decorate([ViewChild('searchProducts', {\n  static: true\n})], NuevaVentaComponent.prototype, \"search\", void 0);\n__decorate([ViewChild('quantity', {\n  static: true\n})], NuevaVentaComponent.prototype, \"quantityProduct\", void 0);\n__decorate([ViewChild('client', {\n  static: true\n})], NuevaVentaComponent.prototype, \"cliente\", void 0);\n__decorate([ViewChild('pay', {\n  static: true\n})], NuevaVentaComponent.prototype, \"pago\", void 0);\nNuevaVentaComponent = __decorate([Component({\n  selector: 'app-nueva-venta',\n  templateUrl: './nueva-venta.component.html',\n  styleUrls: ['./nueva-venta.component.css']\n})], NuevaVentaComponent);\nexport { NuevaVentaComponent };","map":{"version":3,"mappings":"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","names":["Component","ViewChild","FormControl","FormGroup","Validators","DinamicInput","NuevaVentaComponent","constructor","fb","routes","comunicatorSvc","productsSvc","coinsSvc","renderer","clientesSvc","Date","ngOnInit","title","ruta","setTimeout","url","slice","indexOf","push","decodeURI","toUpperCase","setTitleComponent","getCoins","subscribe","next","res","coins","forEach","coin","type","coinSelected","coinPay","complete","formNewPay","get","setValue","symbol","formNewSell","getClients","clientes","cliente","names","includes","document_number","getProductos","listProducts","group","barcode","required","pattern","productQuantity","client","productQuantityBySearch","discount","mount","reference","tableSearch","search","selectMoneda","value","selectMonedaPay","verificarProductoAñadido","product","exist","products","producto","name","addQuantity","values","icon","content","changeModal","popUp","nativeElement","showModal","exist_quantity","quantityProduct","open","receiveMessage","console","log","cancel","addProduct","quantity","valid","getProductoByBarcode","Array","sellProducts","id_sell","id_product","buy_price","sell_price","discount_product","impuest","quantity_products","exist_products","quantity_back","addProductBySearch","acept","index","children","textContent","close","delete","calcularSubtotal","converter","calcularTotal","total","calcularDescuentoVenta","Number","calcularImpuestoVenta","montoImponible","searchProduct","splice","indexElementToDelete","validarVenta","result","isValid","msj","validarPago","agregarPago","sell","total_sell","exchange","state","type_sell","total_pay","id_user","id_client","pago","registrarPago","pay","pays","__decorate","static","selector","templateUrl","styleUrls"],"sourceRoot":"","sources":["/home/luis/Documentos/systems vs code/inventary-system/client/src/app/content/ventas/nueva-venta/nueva-venta.component.ts"],"sourcesContent":["import { Component, ElementRef, Renderer2, ViewChild } from '@angular/core';\nimport { FormBuilder, FormControl, FormGroup, Validators } from '@angular/forms';\nimport { Router } from '@angular/router';\nimport { client, coin, pay, product, register, sell, sell_product } from 'src/app/interfaces/interfaces';\nimport { ComunicatorComponetsService } from 'src/app/services/comunicator/comunicator-componets.service';\nimport { DinamicInput } from 'src/app/utils/DinamicInput';\nimport { ProductosService } from '../../productos/productos-en-almacen/service/productos.service';\nimport { CoinsService } from '../../configuraciones/service/coins.service';\nimport { ClientesService } from '../../administracion/clientes/service/clientes.service';\n\n@Component({\n  selector: 'app-nueva-venta',\n  templateUrl: './nueva-venta.component.html',\n  styleUrls: ['./nueva-venta.component.css'],\n})\nexport class NuevaVentaComponent extends DinamicInput {\n  tableSearch!: FormGroup\n  formNewSell!: FormGroup;\n  products: product[] = []\n  date = new Date()\n  coins: coin[] = []\n  clientes: client[] = []\n  coinSelected!: coin\n  coinPay!: coin\n  formNewPay!: FormGroup\n  sell!: sell\n  pays: pay[] = []\n  sellProducts: sell_product[] = []\n  listProducts: product[] = []\n  product!: product\n  indexElementToDelete: number = 0\n  @ViewChild('popup', { static: true }) override popUp?: ElementRef;\n  @ViewChild('searchProducts', { static: true }) search?: ElementRef;\n  @ViewChild('quantity', { static: true }) quantityProduct?: ElementRef;\n  @ViewChild('client', { static: true }) cliente?: ElementRef;\n  @ViewChild('pay', { static: true }) pago?: ElementRef;\n  constructor(private fb: FormBuilder, private routes: Router,\n    public comunicatorSvc: ComunicatorComponetsService,\n    private productsSvc: ProductosService,\n    private coinsSvc: CoinsService,\n    protected override renderer: Renderer2,\n    private clientesSvc: ClientesService) {\n    super();\n  }\n  ngOnInit() {\n    let title: string[] = [];\n    let ruta;\n    setTimeout(() => {\n      /* Obtengo la ruta actual y la transformo para obtener el titulo del componente*/\n      ruta = this.routes.url.slice((this.routes.url.slice(1).indexOf('/')) + 2);\n      title.push(\"fas fa-cart-plus fa-fw\");//aañado el icono del titulo al array\n      title.push(decodeURI(ruta).toUpperCase());//añado el titulo al array\n      this.comunicatorSvc.setTitleComponent(title);\n    });\n    this.coinsSvc.getCoins().subscribe({\n      next: res => {\n        this.coins = res\n        res.forEach((coin: coin) => {\n          if (coin.type === 'principal')\n            this.coinSelected = coin\n          this.coinPay = coin\n        })\n      },\n      complete: () => {\n        this.formNewPay.get('coin')?.setValue(this.coinPay.symbol)\n        this.formNewSell.get('coin')?.setValue(this.coinSelected.symbol)\n      }\n    })\n    this.clientesSvc.getClients().subscribe(clientes => {\n      this.clientes = clientes\n      clientes.forEach((cliente: client) => {\n        if (cliente.names.includes('Publico')) {\n          this.formNewSell.get('client')?.setValue(cliente.document_number)\n        }\n      })\n    })\n    this.productsSvc.getProductos().subscribe(res => this.listProducts = res)\n    this.formNewSell = this.fb.group({\n      barcode: new FormControl('', [Validators.required, Validators.pattern(/^[0-9]+$/)]),\n      productQuantity: new FormControl('', [Validators.pattern(/^[0-9]+$/)]),\n      client: new FormControl(''),\n      productQuantityBySearch: new FormControl(''),\n      coin: new FormControl(''),\n      discount: new FormControl('', [Validators.pattern(/^[0-9]+$/)]),\n    })\n    this.formNewPay = new FormGroup({\n      type: new FormControl('Transacción eléctronica'),\n      coin: new FormControl(''),\n      mount: new FormControl(0),\n      reference: new FormControl()\n    })\n    this.tableSearch = new FormGroup({\n      search: new FormControl(),\n    });\n  }\n  selectMoneda() {\n    this.coins.forEach((coin) => {\n      if (coin.symbol === this.formNewSell.get('coin')?.value) {\n        this.coinSelected = coin\n      }\n    })\n  }\n  selectMonedaPay() {\n    this.coins.forEach((coin) => {\n      if (coin.symbol === this.formNewPay.get('coin')?.value) {\n        this.coinPay = coin\n      }\n    })\n  }\n  verificarProductoAñadido(product: product) {\n    let exist: boolean = false\n    this.products.forEach((producto: product) => {\n      if (producto.name === product.name) {\n        exist = true\n      } else {\n        exist = false\n      }\n    })\n    return exist\n  }\n  addQuantity(product: product) {\n    let values = {\n      icon: 'fa-regular fa-circle-xmark',\n      title: 'Ocurrió un error inesperado',\n      content: ''\n    }\n    if (this.verificarProductoAñadido(product)) {\n      values.content = 'Este producto ya se encuentra agregado a la venta'\n      this.changeModal(values)\n      this.popUp?.nativeElement.showModal()\n    } else if (product.exist_quantity === 0) {\n      values.content = 'No hay existencias de este producto para vender'\n      this.changeModal(values)\n      this.popUp?.nativeElement.showModal()\n    } else {\n      this.quantityProduct?.nativeElement.showModal()\n      this.product = product\n    }\n  }\n  open() {\n    this.cliente?.nativeElement.showModal()\n  }\n  receiveMessage(client: client) {\n    this.clientes.push(client)\n    console.log(this.clientes)\n    console.log(client)\n    this.formNewSell.get('client')?.setValue(client.document_number)\n    this.cancel(this.cliente)\n  }\n  addProduct() {\n    let quantity: number\n    if (this.formNewSell.get('productQuantity')?.value === '') {\n      quantity = 1\n    } else {\n      quantity = this.formNewSell.get('productQuantity')?.value\n    }\n\n    if (this.formNewSell.get('barcode')?.valid) {\n      this.productsSvc.getProductoByBarcode(this.formNewSell.get('barcode')?.value).subscribe(\n        product => {\n          if (product instanceof Array) {\n\n            if (!this.verificarProductoAñadido(product[0])) {\n              this.sellProducts.push({\n                id_sell: 0, id_product: product[0].id_product,\n                buy_price: 0, sell_price: 0, discount_product: 0, impuest: 0, quantity_products: quantity,\n                exist_products: 0, quantity_back: 0\n              })\n              this.products.push(product[0])\n            }\n          } else {\n            this.changeModal(product)\n            this.popUp?.nativeElement.showModal()\n            this.formNewSell.get('barcode')?.setValue('')\n            this.formNewSell.get('productQuantity')?.setValue('')\n          }\n        })\n    }\n  }\n  addProductBySearch(product: product) {\n    let quantity = this.formNewSell.get('productQuantityBySearch')?.value\n    this.sellProducts.push({\n      id_sell: 0, id_product: product.id_product,\n      buy_price: 0, sell_price: 0, discount_product: 0, impuest: 0, quantity_products: quantity,\n      exist_products: 0, quantity_back: 0\n    })\n    this.products.push(product)\n    this.cancel(this.quantityProduct)\n    this.cancel(this.search)\n  }\n  acept(index: number) {\n    if (this.popUp?.nativeElement.children[1].textContent.includes('error')) {\n      this.popUp?.nativeElement.close()\n    } else if (this.popUp?.nativeElement.children[1].textContent.includes('¿Estás seguro?')) {\n      this.delete(index)\n      this.popUp?.nativeElement.close()\n    } else {\n      this.popUp?.nativeElement.close()\n    }\n  }\n  calcularSubtotal(product: product, index: number) {\n\n    return this.comunicatorSvc.converter((this.products[index].sell_price * this.sellProducts[index].quantity_products) -\n      (this.products[index].sell_price * this.products[index].discount * this.sellProducts[index].quantity_products), this.coinSelected)\n  }\n\n  calcularTotal() {\n    let total = 0\n    this.products.forEach((product: product, index: number) => {\n      total += (this.products[index].sell_price * this.sellProducts[index].quantity_products) -\n        (this.products[index].sell_price * this.products[index].discount * this.sellProducts[index].quantity_products)\n    });\n\n    return this.comunicatorSvc.converter(total, this.coinSelected)\n  }\n  calcularDescuentoVenta() {\n    return (Number(this.formNewSell.get('discount')?.value) / 100) * this.calcularTotal()\n  }\n  calcularImpuestoVenta() {\n    let montoImponible = 0\n    this.products.forEach((product: product, index: number) => {\n      if (product.impuest > 0) {\n        montoImponible += product.impuest * ((product.sell_price * this.sellProducts[index].quantity_products) -\n          (product.sell_price * product.discount * this.sellProducts[index].quantity_products))\n      }\n    })\n    return this.comunicatorSvc.converter(montoImponible, this.coinSelected)\n  }\n  total() {\n    return (this.calcularTotal() + this.calcularImpuestoVenta() - this.calcularDescuentoVenta())\n  }\n  searchProduct() {\n    this.search?.nativeElement.showModal();\n  }\n  delete(index: number) {\n    this.products.splice(this.indexElementToDelete, 1)\n    this.sellProducts.splice(this.indexElementToDelete, 1)\n  }\n  validarVenta() {\n    let result = { isValid: false, msj: 'Agrege productos a la venta' }\n    this.products.forEach((product: product, index: number) => {\n      if (this.sellProducts[index].quantity_products === 0) {\n        result = { isValid: false, msj: 'La cantidad a vender del producto ' + product.name + 'no puede ser 0' }\n      } else if (this.sellProducts[index].quantity_products > product.exist_quantity) {\n        result = { isValid: false, msj: 'La cantidad a vender del producto ' + product.name + ' es mayor a la existente' }\n      } else {\n        result = { isValid: true, msj: '' }\n      }\n    })\n    return result\n  }\n  validarPago() {\n    let result = { isValid: true, msj: '' }\n    if (Number(this.formNewPay.get('mount')?.value) === 0) {\n      result = { isValid: false, msj: 'El monto pagado por el cliente no puede ser 0' }\n    } else if (this.formNewPay.get('type')?.value.includes('Transacción')) {\n      if (Number(this.formNewPay.get('mount')?.value) > this.comunicatorSvc.converter(\n        this.total(), this.coinPay)) {\n        result = { isValid: false, msj: 'El monto pagado por el cliente no puede ser mayor al total a pagar' }\n      } else if (this.formNewPay.get('reference')?.value === null) {\n        result = { isValid: false, msj: 'Debe ingresar la referencia del pago realizado' }\n      }\n    }\n    return result\n  }\n  agregarPago() {\n    this.sell = {\n      id_sell: 0, type: 'venta', total_sell: this.total(), coin: this.coinSelected.symbol,\n      exchange: this.coinSelected.exchange, state: '', type_sell: '', total_pay: 0,\n      discount: this.formNewSell.get('discount')?.value, id_user: 16, id_client: 0\n    }\n    this.pago?.nativeElement.showModal();\n  }\n  registrarPago() {\n    if (this.validarPago().isValid) {\n      let pay: pay = this.formNewPay.value\n      pay.exchange = this.coinPay.exchange\n\n      console.log(pay)\n      this.sell.total_pay += pay.mount\n      this.pays.push(pay)\n      let msj = {\n        icon: '', title: '¡Pago Registrado!', content: 'El pago se registró  con exito en el sístema'\n      }\n      this.changeModal(msj)\n      this.popUp?.nativeElement.showModal()\n    }\n  }\n\n}\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}