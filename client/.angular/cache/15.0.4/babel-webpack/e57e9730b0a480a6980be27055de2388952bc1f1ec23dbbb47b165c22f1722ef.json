{"ast":null,"code":"import { FormControl } from '@angular/forms';\nimport { DinamicInput } from 'src/app/utils/DinamicInput';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/router\";\nimport * as i2 from \"src/app/services/comunicator/comunicator-componets.service\";\nimport * as i3 from \"../../ventas/service/ventas.service\";\nimport * as i4 from \"../../administracion/usuarios/service/usuarios.service\";\nimport * as i5 from \"../../productos/productos-en-almacen/service/productos.service\";\nimport * as i6 from \"@angular/forms\";\nimport * as i7 from \"@angular/common\";\nimport * as i8 from \"../../devoluciones/service/devoluciones.service\";\nconst _c0 = [\"quantity\"];\nconst _c1 = [\"popup\"];\nfunction DetallesVentaComponent_tr_32_td_3_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"td\");\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const i_r7 = i0.ɵɵnextContext().index;\n    const ctx_r8 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(ctx_r8.products[i_r7].barcode);\n  }\n}\nfunction DetallesVentaComponent_tr_32_td_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"td\");\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const i_r7 = i0.ɵɵnextContext().index;\n    const ctx_r9 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate3(\" \", ctx_r9.products[i_r7].name, \"\\u00A0\", ctx_r9.products[i_r7].mark, \"\\u00A0\", ctx_r9.products[i_r7].model, \"\\u00A0\");\n  }\n}\nfunction DetallesVentaComponent_tr_32_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r13 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"tr\")(1, \"td\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(3, DetallesVentaComponent_tr_32_td_3_Template, 2, 1, \"td\", 11);\n    i0.ɵɵtemplate(4, DetallesVentaComponent_tr_32_td_4_Template, 2, 3, \"td\", 11);\n    i0.ɵɵelementStart(5, \"td\");\n    i0.ɵɵtext(6);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"td\");\n    i0.ɵɵtext(8);\n    i0.ɵɵpipe(9, \"currency\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(10, \"td\");\n    i0.ɵɵtext(11);\n    i0.ɵɵpipe(12, \"currency\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(13, \"td\", 30);\n    i0.ɵɵlistener(\"click\", function DetallesVentaComponent_tr_32_Template_td_click_13_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r13);\n      const i_r7 = restoredCtx.index;\n      const ctx_r12 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r12.showModal(ctx_r12.products[i_r7], i_r7));\n    });\n    i0.ɵɵelement(14, \"i\", 31);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const sell_product_r6 = ctx.$implicit;\n    const i_r7 = ctx.index;\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(i_r7 + 1);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.products[i_r7] != undefined);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.products[i_r7] != undefined);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"\", sell_product_r6.quantity_products, \" \");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind2(9, 6, sell_product_r6.buy_price, ctx_r1.sell.coin + \" \"));\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind2(12, 9, sell_product_r6.quantity_products * sell_product_r6.sell_price, ctx_r1.sell.coin + \" \"));\n  }\n}\nfunction DetallesVentaComponent_tr_33_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"tr\");\n    i0.ɵɵelement(1, \"td\")(2, \"td\")(3, \"td\")(4, \"td\");\n    i0.ɵɵelementStart(5, \"td\")(6, \"strong\");\n    i0.ɵɵtext(7, \"Total\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelement(8, \"td\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction DetallesVentaComponent_button_88_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r15 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"button\", 32);\n    i0.ɵɵlistener(\"click\", function DetallesVentaComponent_button_88_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r15);\n      const ctx_r14 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r14.cancel(ctx_r14.popUp));\n    });\n    i0.ɵɵtext(1, \" \\u00A0\\u00A0CANCELAR\");\n    i0.ɵɵelementEnd();\n  }\n}\nconst _c2 = function (a0, a1) {\n  return {\n    \"input-on-focus-success\": a0,\n    \"input-on-focus-fail\": a1\n  };\n};\nconst _c3 = function (a0, a1) {\n  return {\n    \"label-on-focus-down\": a0,\n    \"label-on-focus-up\": a1\n  };\n};\nconst _c4 = function (a0) {\n  return {\n    \"enable aceptar\": a0\n  };\n};\nexport class DetallesVentaComponent extends DinamicInput {\n  constructor(routes, comunicatorSvc, renderer, route, ventasSvc, usuariosSvc, productosSvc, fb, location, devolucionesSvc) {\n    super();\n    this.routes = routes;\n    this.comunicatorSvc = comunicatorSvc;\n    this.renderer = renderer;\n    this.route = route;\n    this.ventasSvc = ventasSvc;\n    this.usuariosSvc = usuariosSvc;\n    this.productosSvc = productosSvc;\n    this.fb = fb;\n    this.location = location;\n    this.devolucionesSvc = devolucionesSvc;\n    this.title = [];\n    this.sell_products = [];\n    this.repayments = [];\n    this.products = [];\n  }\n  ngOnInit() {\n    setTimeout(() => {\n      /* Obtengo la ruta actual y la transformo para obtener el titulo del componente*/\n      this.ruta = this.routes.url.slice(this.routes.url.slice(1).indexOf('/') + 2, this.routes.url.lastIndexOf('?'));\n      this.title.push(\"fas fa-coins fa-fw\"); //aañado el icono del titulo al array\n      this.title.push(decodeURI(this.ruta).toUpperCase()); //añado el titulo al array\n      this.comunicatorSvc.setTitleComponent(this.title);\n    });\n    this.route.queryParams.subscribe(params => {\n      this.ventasSvc.getSell(params['id_sell']).subscribe(res => {\n        console.log(res);\n        let aux = res;\n        this.sell = aux[0];\n        console.log('venta');\n        console.log(this.sell);\n      });\n      this.ventasSvc.getProductsSell(params['id_sell']).subscribe(res => {\n        if (res instanceof Array) {\n          let aux = res;\n          this.products = aux;\n          this.sell_products = aux;\n        }\n      });\n    });\n    this.formDevolucion = this.fb.group({\n      quantity_back: new FormControl('')\n    });\n  }\n  showModal(product, index) {\n    this.indexElementToBack = index;\n    this.renderer.setProperty(this.quantityBack?.nativeElement.children[0].children[0], 'textContent', 'Realizar Devolución (' + product.name + ' ' + product.mark + ' ' + product.model + ')');\n    this.quantityBack?.nativeElement.showModal();\n  }\n  calcularPromedio(price) {\n    return (this.products[this.indexElementToBack].sell_price * this.products[this.indexElementToBack].exist_quantity - this.sell_products[this.indexElementToBack].sell_price * Number(this.formDevolucion.get('quantity_back')?.value)) / (this.products[this.indexElementToBack].exist_quantity - Number(this.formDevolucion.get('quantity_back')?.value));\n  }\n  registrarDevolucion() {\n    let content = '';\n    if (Number(this.formDevolucion.get('quantity_back')?.value) > this.sell_products[this.indexElementToBack].quantity_products - this.sell_products[this.indexElementToBack].quantity_back) {\n      content = 'La cantidad a devolver es mayor a la registrada en la compra';\n    } else if (this.products[this.indexElementToBack].exist_quantity - Number(this.formDevolucion.get('quantity_back')?.value) < 0) {\n      content = 'No existe esa cantidad en el almacen, los productos ya han sido vendidos';\n    } else {\n      let repayment = {\n        type: 'compra',\n        date: new Date(),\n        id_operation: this.sell_products[this.indexElementToBack].id_sell,\n        quantity: Number(this.formDevolucion.get('quantity_back')?.value),\n        price: this.sell_products[this.indexElementToBack].sell_price,\n        total: Number(this.formDevolucion.get('quantity_back')?.value) * this.sell_products[this.indexElementToBack].sell_price,\n        coin: this.sell.coin,\n        exist_quantity: this.products[this.indexElementToBack].exist_quantity - Number(this.formDevolucion.get('quantity_back')?.value),\n        weighted_averages: Number(((this.products[this.indexElementToBack].sell_price * this.products[this.indexElementToBack].exist_quantity - this.comunicatorSvc.converterToMainCoin(this.sell_products[this.indexElementToBack].sell_price, this.sell.exchange) * Number(this.formDevolucion.get('quantity_back')?.value)) / (this.products[this.indexElementToBack].exist_quantity - Number(this.formDevolucion.get('quantity_back')?.value))).toFixed(2)),\n        id_user: this.sell.id_user,\n        id_product: this.sell_products[this.indexElementToBack].id_product\n      };\n      repayment.weighted_averages = isNaN(repayment.weighted_averages) ? 0 : repayment.weighted_averages;\n      repayment.weighted_averages = this.comunicatorSvc.converterToSecondaryCoin(repayment.weighted_averages, this.sell.exchange);\n      this.devolucionesSvc.setRepayment(repayment).subscribe(res => {\n        if (res.title.includes('Registrada')) {\n          this.repayments.push(repayment);\n          this.sell_products[this.indexElementToBack].quantity_back += Number(this.formDevolucion.get('quantity_back')?.value);\n          this.sell.total_sell -= Number(this.formDevolucion.get('quantity_back')?.value) * this.sell_products[this.indexElementToBack].sell_price;\n          this.products[this.indexElementToBack].sell_price = this.comunicatorSvc.converterToMainCoin(repayment.weighted_averages, this.sell.exchange);\n          this.products[this.indexElementToBack].sell_price = Number(((this.products[this.indexElementToBack].sell_price * this.products[this.indexElementToBack].exist_quantity - this.comunicatorSvc.converterToMainCoin(this.sell_products[this.indexElementToBack].sell_price, this.sell.exchange) * Number(this.formDevolucion.get('quantity_back')?.value)) / (this.products[this.indexElementToBack].exist_quantity - Number(this.formDevolucion.get('quantity_back')?.value))).toFixed(2));\n          this.products[this.indexElementToBack].exist_quantity = repayment.exist_quantity;\n          console.log(this.products[this.indexElementToBack].sell_price);\n          this.products[this.indexElementToBack].sell_price = this.products[this.indexElementToBack].exist_quantity === 0 ? 0 : this.products[this.indexElementToBack].sell_price;\n          this.ventasSvc.updateSell(this.sell_products[this.indexElementToBack].id_sell, this.sell).subscribe(res => console.log(res));\n          this.ventasSvc.updateProductsSell(this.sell_products[this.indexElementToBack].id_sell, this.sell_products[this.indexElementToBack].id_product, this.sell_products[this.indexElementToBack]).subscribe(res => console.log(res));\n          this.productosSvc.updateProducto(this.products[this.indexElementToBack].id_product, this.products[this.indexElementToBack]).subscribe(res => console.log(res));\n        }\n        console.log(res);\n        this.changeModal(res);\n        this.popUp?.nativeElement.showModal();\n      });\n    }\n    if (content !== '') {\n      let values = {\n        icon: 'fa-regular fa-circle-xmark',\n        title: 'Ocurrió un error inesperado',\n        content: content\n      };\n      this.changeModal(values);\n      this.popUp?.nativeElement.showModal();\n    }\n  }\n  calcularTotal() {\n    this.quantityBack?.nativeElement;\n    let total = 0;\n    this.sell_products.forEach(sell_product => {\n      total += sell_product.sell_price * sell_product.quantity_products;\n    });\n    return total;\n  }\n  redirectToVentasRealizadas() {\n    this.location.back();\n  }\n  product(repayment) {\n    let name_product = '';\n    this.products.forEach(product => {\n      if (product.id_product === repayment.id_product) {\n        name_product = product.name + ' ' + product.mark + ' ' + product.model;\n      }\n    });\n    return name_product;\n  }\n  acept() {\n    if (this.popUp?.nativeElement.children[1].textContent === 'Ocurrió un error inesperado') {\n      this.cancel(this.popUp);\n    } else {\n      this.cancel(this.popUp);\n      this.cancel(this.quantityBack);\n    }\n  }\n}\nDetallesVentaComponent.ɵfac = function DetallesVentaComponent_Factory(t) {\n  return new (t || DetallesVentaComponent)(i0.ɵɵdirectiveInject(i1.Router), i0.ɵɵdirectiveInject(i2.ComunicatorComponetsService), i0.ɵɵdirectiveInject(i0.Renderer2), i0.ɵɵdirectiveInject(i1.ActivatedRoute), i0.ɵɵdirectiveInject(i3.VentasService), i0.ɵɵdirectiveInject(i4.UsuariosService), i0.ɵɵdirectiveInject(i5.ProductosService), i0.ɵɵdirectiveInject(i6.FormBuilder), i0.ɵɵdirectiveInject(i7.Location), i0.ɵɵdirectiveInject(i8.DevolucionesService));\n};\nDetallesVentaComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: DetallesVentaComponent,\n  selectors: [[\"app-detalles-venta\"]],\n  viewQuery: function DetallesVentaComponent_Query(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵviewQuery(_c0, 7);\n      i0.ɵɵviewQuery(_c1, 7);\n    }\n    if (rf & 2) {\n      let _t;\n      i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.quantityBack = _t.first);\n      i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.popUp = _t.first);\n    }\n  },\n  features: [i0.ɵɵInheritDefinitionFeature],\n  decls: 89,\n  vars: 18,\n  consts: [[1, \"form-container\"], [1, \"datos\"], [1, \"form-button\", \"btn-save\", 3, \"click\"], [1, \"fas\", \"fa-reply\"], [1, \"table-container\"], [1, \"table-title\"], [1, \"table-body\"], [1, \"table-responsive\"], [1, \"table\", \"table-bordered\"], [\"tab\", \"\"], [4, \"ngFor\", \"ngForOf\"], [4, \"ngIf\"], [1, \"quantity\"], [\"quantity\", \"\"], [1, \"header\"], [1, \"title\"], [1, \"btn-cerrar-dialog\", 3, \"click\"], [1, \"form\", 3, \"formGroup\"], [1, \"form-control\", 3, \"ngClass\"], [1, \"form-label\", 3, \"ngClass\", \"ngStyle\"], [\"formControlName\", \"quantity_back\", 1, \"form-input\", 3, \"ngStyle\", \"focus\", \"focusout\", \"keypress\"], [1, \"form-actions\"], [1, \"form-button\", \"btn\", 3, \"ngClass\", \"click\"], [1, \"fas\", \"fa-truck-loading\", \"fa-fw\"], [1, \"form-button\", \"btn\", \"enable\", 2, \"color\", \"#f44336\", 3, \"click\"], [1, \"far\", \"fa-times-circle\"], [1, \"dialog\"], [\"popup\", \"\"], [1, \"fa-regular\", \"fa-circle-question\"], [\"class\", \"form-button btn-cancel\", 3, \"click\", 4, \"ngIf\"], [1, \"icon\", 3, \"click\"], [1, \"fas\", \"fa-truck-loading\", \"fa-fw\", 2, \"color\", \"#009688\"], [1, \"form-button\", \"btn-cancel\", 3, \"click\"]],\n  template: function DetallesVentaComponent_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵelementStart(0, \"div\", 0)(1, \"div\", 1)(2, \"p\");\n      i0.ɵɵtext(3);\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(4, \"button\", 2);\n      i0.ɵɵlistener(\"click\", function DetallesVentaComponent_Template_button_click_4_listener() {\n        return ctx.redirectToVentasRealizadas();\n      });\n      i0.ɵɵelement(5, \"i\", 3);\n      i0.ɵɵtext(6, \" \\u00A0Regresar\");\n      i0.ɵɵelementEnd()();\n      i0.ɵɵelementStart(7, \"div\", 4)(8, \"div\", 5)(9, \"h6\");\n      i0.ɵɵtext(10, \"productos vendidos\");\n      i0.ɵɵelementEnd()();\n      i0.ɵɵelementStart(11, \"div\", 6)(12, \"div\", 7)(13, \"table\", 8)(14, \"thead\")(15, \"tr\")(16, \"th\");\n      i0.ɵɵtext(17, \"N\\u00B0\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(18, \"th\");\n      i0.ɵɵtext(19, \"C\\u00F3digo de barra\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(20, \"th\");\n      i0.ɵɵtext(21, \"Producto\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(22, \"th\");\n      i0.ɵɵtext(23, \"Cantidad\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(24, \"th\");\n      i0.ɵɵtext(25, \"Precio de compra\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(26, \"th\");\n      i0.ɵɵtext(27, \"Sub total\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(28, \"th\");\n      i0.ɵɵtext(29, \"Devoluci\\u00F3n\");\n      i0.ɵɵelementEnd()()();\n      i0.ɵɵelementStart(30, \"tbody\", null, 9);\n      i0.ɵɵtemplate(32, DetallesVentaComponent_tr_32_Template, 15, 12, \"tr\", 10);\n      i0.ɵɵtemplate(33, DetallesVentaComponent_tr_33_Template, 9, 0, \"tr\", 11);\n      i0.ɵɵelementEnd()()()()();\n      i0.ɵɵelementStart(34, \"div\", 4)(35, \"div\", 5)(36, \"h6\");\n      i0.ɵɵtext(37, \"Devoluciones realizadas\");\n      i0.ɵɵelementEnd()();\n      i0.ɵɵelementStart(38, \"div\", 6)(39, \"div\", 7)(40, \"table\", 8)(41, \"thead\")(42, \"tr\")(43, \"th\");\n      i0.ɵɵtext(44, \"N\\u00B0\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(45, \"th\");\n      i0.ɵɵtext(46, \"Fecha\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(47, \"th\");\n      i0.ɵɵtext(48, \"Producto\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(49, \"th\");\n      i0.ɵɵtext(50, \"Cantidad\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(51, \"th\");\n      i0.ɵɵtext(52, \"Precio de compra\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(53, \"th\");\n      i0.ɵɵtext(54, \"Total\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(55, \"th\");\n      i0.ɵɵtext(56, \"Vendedor\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(57, \"th\");\n      i0.ɵɵtext(58, \"caja\");\n      i0.ɵɵelementEnd()()()()()()()();\n      i0.ɵɵelementStart(59, \"dialog\", 12, 13)(61, \"div\", 14)(62, \"h2\", 15);\n      i0.ɵɵtext(63, \"Realizar devoluci\\u00F3n\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(64, \"button\", 16);\n      i0.ɵɵlistener(\"click\", function DetallesVentaComponent_Template_button_click_64_listener() {\n        return ctx.cancel(ctx.quantityBack);\n      });\n      i0.ɵɵtext(65, \"x\");\n      i0.ɵɵelementEnd()();\n      i0.ɵɵelementStart(66, \"div\", 17)(67, \"div\", 18)(68, \"label\", 19);\n      i0.ɵɵtext(69, \" Cantidad a devolver \");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(70, \"input\", 20);\n      i0.ɵɵlistener(\"focus\", function DetallesVentaComponent_Template_input_focus_70_listener() {\n        return ctx.isFocused(7, ctx.formDevolucion, \"quantity_back\");\n      })(\"focusout\", function DetallesVentaComponent_Template_input_focusout_70_listener() {\n        return ctx.isFocused(7, ctx.formDevolucion, \"quantity_back\");\n      })(\"keypress\", function DetallesVentaComponent_Template_input_keypress_70_listener($event) {\n        return ctx.validate($event, false);\n      });\n      i0.ɵɵelementEnd()()();\n      i0.ɵɵelementStart(71, \"div\", 21)(72, \"button\", 22);\n      i0.ɵɵlistener(\"click\", function DetallesVentaComponent_Template_button_click_72_listener() {\n        return ctx.registrarDevolucion();\n      });\n      i0.ɵɵelement(73, \"i\", 23);\n      i0.ɵɵtext(74, \" \\u00A0\\u00A0REALIZAR DEVOLUCI\\u00D3N\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(75, \"button\", 24);\n      i0.ɵɵlistener(\"click\", function DetallesVentaComponent_Template_button_click_75_listener() {\n        return ctx.cancel(ctx.quantityBack);\n      });\n      i0.ɵɵelement(76, \"i\", 25);\n      i0.ɵɵtext(77, \" \\u00A0\\u00A0CANCELAR\");\n      i0.ɵɵelementEnd()()();\n      i0.ɵɵelementStart(78, \"dialog\", 26, 27);\n      i0.ɵɵelement(80, \"i\", 28);\n      i0.ɵɵelementStart(81, \"h3\");\n      i0.ɵɵtext(82, \"\\u00BFEstas seguro?\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(83, \"p\");\n      i0.ɵɵtext(84, \"Lois datos seran guardados en el sistema\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(85, \"div\")(86, \"button\", 2);\n      i0.ɵɵlistener(\"click\", function DetallesVentaComponent_Template_button_click_86_listener() {\n        return ctx.acept();\n      });\n      i0.ɵɵtext(87, \" \\u00A0\\u00A0ACEPTAR\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵtemplate(88, DetallesVentaComponent_button_88_Template, 2, 0, \"button\", 29);\n      i0.ɵɵelementEnd()();\n    }\n    if (rf & 2) {\n      let tmp_8_0;\n      i0.ɵɵadvance(3);\n      i0.ɵɵtextInterpolate1(\"id sell \", ctx.sell.id_sell, \"\");\n      i0.ɵɵadvance(29);\n      i0.ɵɵproperty(\"ngForOf\", ctx.sell_products);\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngIf\", ctx.sell_products.length > 0);\n      i0.ɵɵadvance(33);\n      i0.ɵɵproperty(\"formGroup\", ctx.formDevolucion);\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngClass\", i0.ɵɵpureFunction2(10, _c2, ctx.verifyStyleInput(ctx.formDevolucion, \"quantity_back\") && ctx.elementHasFocus[7], !ctx.verifyStyleInput(ctx.formDevolucion, \"quantity_back\")));\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngClass\", i0.ɵɵpureFunction2(13, _c3, ctx.elementHasFocus[7] && ctx.positionLabel[7], ctx.elementHasFocus[7] && !ctx.positionLabel[7]))(\"ngStyle\", ctx.animationLabel(ctx.formDevolucion, \"quantity_back\"));\n      i0.ɵɵadvance(2);\n      i0.ɵɵproperty(\"ngStyle\", ctx.styleForeground(ctx.formDevolucion, \"quantity_back\"));\n      i0.ɵɵadvance(2);\n      i0.ɵɵproperty(\"ngClass\", i0.ɵɵpureFunction1(16, _c4, ((tmp_8_0 = ctx.formDevolucion.get(\"quantity_back\")) == null ? null : tmp_8_0.value.length) > 0));\n      i0.ɵɵadvance(16);\n      i0.ɵɵproperty(\"ngIf\", (ctx.popUp == null ? null : ctx.popUp.nativeElement.children[1].textContent) === \"\\u00BFEst\\u00E1s seguro?\");\n    }\n  },\n  dependencies: [i7.NgClass, i7.NgForOf, i7.NgIf, i7.NgStyle, i6.DefaultValueAccessor, i6.NgControlStatus, i6.NgControlStatusGroup, i6.FormGroupDirective, i6.FormControlName, i7.CurrencyPipe],\n  styles: [\"\\n/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IiIsInNvdXJjZVJvb3QiOiIifQ== */\"]\n});","map":{"version":3,"mappings":"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","names":["FormControl","DinamicInput","i0","DetallesVentaComponent","constructor","routes","comunicatorSvc","renderer","route","ventasSvc","usuariosSvc","productosSvc","fb","location","devolucionesSvc","ngOnInit","setTimeout","ruta","url","slice","indexOf","lastIndexOf","title","push","decodeURI","toUpperCase","setTitleComponent","queryParams","subscribe","params","getSell","res","console","log","aux","sell","getProductsSell","Array","products","sell_products","formDevolucion","group","quantity_back","showModal","product","index","indexElementToBack","setProperty","quantityBack","nativeElement","children","name","mark","model","calcularPromedio","price","sell_price","exist_quantity","Number","get","value","registrarDevolucion","content","quantity_products","repayment","type","date","Date","id_operation","id_sell","quantity","total","coin","weighted_averages","converterToMainCoin","exchange","toFixed","id_user","id_product","isNaN","converterToSecondaryCoin","setRepayment","includes","repayments","total_sell","updateSell","updateProductsSell","updateProducto","changeModal","popUp","values","icon","calcularTotal","forEach","sell_product","redirectToVentasRealizadas","back","name_product","acept","textContent","cancel","selectors","viewQuery","ctx"],"sourceRoot":"","sources":["/home/luis/Documentos/systems vs code/inventary-system/client/src/app/content/ventas/detalles-venta/detalles-venta.component.ts","/home/luis/Documentos/systems vs code/inventary-system/client/src/app/content/ventas/detalles-venta/detalles-venta.component.html"],"sourcesContent":["import { Component, ElementRef, Renderer2, ViewChild } from '@angular/core';\nimport { FormBuilder, FormControl, FormGroup } from '@angular/forms';\nimport { ActivatedRoute, Router } from '@angular/router';\nimport { product, repayment, sell, sell_product, user, alert } from 'src/app/interfaces/interfaces';\nimport { ComunicatorComponetsService } from 'src/app/services/comunicator/comunicator-componets.service';\nimport { DinamicInput } from 'src/app/utils/DinamicInput';\nimport { VentasService } from '../../ventas/service/ventas.service';\nimport { UsuariosService } from '../../administracion/usuarios/service/usuarios.service';\nimport { ProductosService } from '../../productos/productos-en-almacen/service/productos.service';\nimport { DevolucionesService } from '../../devoluciones/service/devoluciones.service';\nimport { Location } from '@angular/common';\n\n@Component({\n  selector: 'app-detalles-venta',\n  templateUrl: './detalles-venta.component.html',\n  styleUrls: ['./detalles-venta.component.css']\n})\nexport class DetallesVentaComponent extends DinamicInput {\n\n  ruta!: string\n  title: string[] = []\n  sell!: sell\n  user!: user\n  sell_products: sell_product[] = []\n  repayments: repayment[] = []\n  products: product[] = []\n  indexElementToBack!: number\n  formDevolucion!: FormGroup\n  @ViewChild('quantity', { static: true }) quantityBack?: ElementRef;\n  @ViewChild('popup', { static: true }) override popUp?: ElementRef;\n\n  constructor(private routes: Router,\n    private comunicatorSvc: ComunicatorComponetsService,\n    public override renderer: Renderer2,\n    private route: ActivatedRoute,\n    private ventasSvc: VentasService,\n    private usuariosSvc: UsuariosService,\n    private productosSvc: ProductosService,\n    private fb: FormBuilder,\n    private location: Location,\n    private devolucionesSvc: DevolucionesService) {\n    super()\n  }\n\n  ngOnInit() {\n    setTimeout(() => {\n      /* Obtengo la ruta actual y la transformo para obtener el titulo del componente*/\n      this.ruta = this.routes.url.slice((this.routes.url.slice(1).indexOf('/')) + 2, this.routes.url.lastIndexOf('?'));\n      this.title.push(\"fas fa-coins fa-fw\");//aañado el icono del titulo al array\n      this.title.push(decodeURI(this.ruta).toUpperCase());//añado el titulo al array\n      this.comunicatorSvc.setTitleComponent(this.title);\n    });\n    this.route.queryParams.subscribe((params) => {\n      this.ventasSvc.getSell(params['id_sell']).subscribe(res => {\n        console.log(res)\n        let aux: any = res\n        this.sell = aux[0]\n        console.log('venta')\n        console.log(this.sell)\n      })\n      this.ventasSvc.getProductsSell(params['id_sell']).subscribe(res => {\n        if (res instanceof Array){\n          let aux:any=res\n          this.products=aux\n          this.sell_products = aux\n        }\n      })\n    })\n    this.formDevolucion = this.fb.group({\n      quantity_back: new FormControl('')\n    })\n  }\n  showModal(product: product, index: number) {\n    this.indexElementToBack = index\n    this.renderer.setProperty(this.quantityBack?.nativeElement.children[0].children[0],\n      'textContent', 'Realizar Devolución (' + product.name + ' ' + product.mark + ' ' + product.model + ')')\n    this.quantityBack?.nativeElement.showModal()\n  }\n  calcularPromedio(price: number) {\n    return ((this.products[this.indexElementToBack].sell_price *\n      this.products[this.indexElementToBack].exist_quantity) -\n      (this.sell_products[this.indexElementToBack].sell_price *\n        Number(this.formDevolucion.get('quantity_back')?.value))) /\n      (this.products[this.indexElementToBack].exist_quantity -\n        Number(this.formDevolucion.get('quantity_back')?.value))\n  }\n  registrarDevolucion() {\n    let content = ''\n    if (Number(this.formDevolucion.get('quantity_back')?.value) >\n      (this.sell_products[this.indexElementToBack].quantity_products -\n        this.sell_products[this.indexElementToBack].quantity_back)) {\n      content = 'La cantidad a devolver es mayor a la registrada en la compra'\n    } else if ((this.products[this.indexElementToBack].exist_quantity -\n      Number(this.formDevolucion.get('quantity_back')?.value)) < 0) {\n      content = 'No existe esa cantidad en el almacen, los productos ya han sido vendidos'\n    } else {\n      let repayment: repayment = {\n        type: 'compra',\n        date: new Date(),\n        id_operation: this.sell_products[this.indexElementToBack].id_sell,\n        quantity: Number(this.formDevolucion.get('quantity_back')?.value),\n        price: this.sell_products[this.indexElementToBack].sell_price,\n        total: Number(this.formDevolucion.get('quantity_back')?.value) *\n          this.sell_products[this.indexElementToBack].sell_price,\n        coin: this.sell.coin,\n        exist_quantity: this.products[this.indexElementToBack].exist_quantity - Number(this.formDevolucion.get('quantity_back')?.value),\n        weighted_averages: Number((((this.products[this.indexElementToBack].sell_price *\n          this.products[this.indexElementToBack].exist_quantity) -\n          (this.comunicatorSvc.converterToMainCoin(this.sell_products[this.indexElementToBack].sell_price, this.sell.exchange) *\n            Number(this.formDevolucion.get('quantity_back')?.value))) /\n          (this.products[this.indexElementToBack].exist_quantity -\n            Number(this.formDevolucion.get('quantity_back')?.value))).toFixed(2)),\n        id_user: this.sell.id_user,\n        id_product: this.sell_products[this.indexElementToBack].id_product,\n      }\n      repayment.weighted_averages = (isNaN(repayment.weighted_averages)) ? 0 : repayment.weighted_averages\n      repayment.weighted_averages = this.comunicatorSvc.converterToSecondaryCoin(repayment.weighted_averages, this.sell.exchange)\n      this.devolucionesSvc.setRepayment(repayment).subscribe(res => {\n        if (res.title.includes('Registrada')) {\n          this.repayments.push(repayment)\n          this.sell_products[this.indexElementToBack].quantity_back += Number(this.formDevolucion.get('quantity_back')?.value)\n          this.sell.total_sell -= (Number(this.formDevolucion.get('quantity_back')?.value) *\n            this.sell_products[this.indexElementToBack].sell_price)\n          this.products[this.indexElementToBack].sell_price = this.comunicatorSvc.converterToMainCoin(\n            repayment.weighted_averages, this.sell.exchange)\n\n          this.products[this.indexElementToBack].sell_price =\n            Number((((this.products[this.indexElementToBack].sell_price *\n              this.products[this.indexElementToBack].exist_quantity) -\n              (this.comunicatorSvc.converterToMainCoin(this.sell_products[this.indexElementToBack].sell_price, this.sell.exchange) *\n                Number(this.formDevolucion.get('quantity_back')?.value))) /\n              (this.products[this.indexElementToBack].exist_quantity -\n                Number(this.formDevolucion.get('quantity_back')?.value))).toFixed(2))\n          this.products[this.indexElementToBack].exist_quantity = repayment.exist_quantity\n          console.log(this.products[this.indexElementToBack].sell_price)\n          this.products[this.indexElementToBack].sell_price = (\n            this.products[this.indexElementToBack].exist_quantity === 0) ? 0 : this.products[this.indexElementToBack].sell_price\n          this.ventasSvc.updateSell(this.sell_products[this.indexElementToBack].id_sell, this.sell).subscribe(\n            res => console.log(res)\n          )\n          this.ventasSvc.updateProductsSell(this.sell_products[this.indexElementToBack].id_sell,\n            this.sell_products[this.indexElementToBack].id_product, this.sell_products[this.indexElementToBack]).subscribe(\n              res => console.log(res)\n            )\n          this.productosSvc.updateProducto(this.products[this.indexElementToBack].id_product,\n            this.products[this.indexElementToBack]).subscribe(res => console.log(res))\n        }\n        console.log(res)\n        this.changeModal(res)\n        this.popUp?.nativeElement.showModal()\n      })\n    }\n    if (content !== '') {\n      let values: alert = {\n        icon: 'fa-regular fa-circle-xmark',\n        title: 'Ocurrió un error inesperado',\n        content: content\n      }\n      this.changeModal(values)\n      this.popUp?.nativeElement.showModal()\n    }\n  }\n\n  calcularTotal() {\n    this.quantityBack?.nativeElement\n    let total = 0;\n    this.sell_products.forEach((sell_product: sell_product) => {\n      total += sell_product.sell_price * sell_product.quantity_products\n    })\n    return total\n  }\n  redirectToVentasRealizadas() {\n    this.location.back()\n  }\n  product(repayment: repayment) {\n    let name_product = ''\n    this.products.forEach((product: product) => {\n      if (product.id_product === repayment.id_product) {\n        name_product = product.name + ' ' + product.mark + ' ' + product.model\n      }\n    })\n    return name_product\n  }\n  acept() {\n    if (this.popUp?.nativeElement.children[1].textContent === 'Ocurrió un error inesperado') {\n      this.cancel(this.popUp)\n    } else {\n      this.cancel(this.popUp)\n      this.cancel(this.quantityBack)\n    }\n  }\n}\n","<div class=\"form-container\">\n    <div class=\"datos\">\n        <p>id sell {{sell.id_sell}}</p>\n        <button (click)=\"redirectToVentasRealizadas()\"\n         class=\"form-button btn-save\"><i class=\"fas fa-reply\"></i> &nbsp;Regresar</button>\n    </div>\n    <div class=\"table-container\">\n        <div class=\"table-title\">\n            <h6>productos vendidos</h6>\n        </div>\n        <div class=\"table-body\">\n            <div class=\"table-responsive\">\n                <table class=\"table table-bordered\">\n                    <thead>\n                        <tr>\n                            <th>N°</th>\n                            <th>Código de barra</th>\n                            <th>Producto</th>\n                            <th>Cantidad</th>\n                            <th>Precio de compra</th>\n                            <th>Sub total</th>\n                            <th>Devolución</th>\n                        </tr>\n                    </thead>\n\n                     <tbody #tab>\n                        <tr *ngFor=\"let sell_product of sell_products; let i=index\">\n                            <td>{{i+1}}</td>\n                             <td *ngIf=\"products[i]!=undefined\">{{products[i].barcode}}</td>\n                            <td *ngIf=\"products[i]!=undefined\">\n                                {{products[i].name}}&nbsp;{{products[i].mark}}&nbsp;{{products[i].model}}&nbsp;</td>\n                            <td>{{sell_product.quantity_products}} </td>\n                            <td>{{sell_product.buy_price|currency:sell.coin+' '}}</td>\n                            <td>{{sell_product.quantity_products*sell_product.sell_price|currency:sell.coin+' '}}</td>\n                            <td class=\"icon\" (click)=\"showModal(products[i],i)\">\n                                <i class=\"fas fa-truck-loading fa-fw\" style=\"color:#009688\"></i>\n                            </td>\n                        </tr>\n                     <tr *ngIf=\"sell_products.length>0\">\n                        <td></td>\n                        <td></td>\n                        <td></td>\n                        <td></td>\n                        <td><strong>Total</strong></td>\n                        <!-- <td>{{calcularTotal()|currency:buy.coin+' '}}</td> -->\n                        <td></td>\n                    </tr>\n                    </tbody> \n                </table>\n            </div>\n        </div>\n    </div>\n    <div class=\"table-container\">\n        <div class=\"table-title\">\n            <h6>Devoluciones realizadas</h6>\n        </div>\n        <div class=\"table-body\">\n            <div class=\"table-responsive\">\n                <table class=\"table table-bordered\">\n                    <thead>\n                        <tr>\n                            <th>N°</th>\n                            <th>Fecha</th>\n                            <th>Producto</th>\n                            <th>Cantidad</th>\n                            <th>Precio de compra</th>\n                            <th>Total</th>\n                            <th>Vendedor</th>\n                            <th>caja</th>\n                        </tr>\n                    </thead>\n\n                    <!-- <tbody #tab>\n                       <tr *ngFor=\"let repayment of repayments; let i=index\">\n                        <td>{{i+1}}</td>\n                        <td>{{repayment.date|date:'dd/MM/yyyy'}}</td>\n                        <td>{{product(repayment)}}</td> \n                        <td>{{repayment.quantity}}</td>\n                        <td>{{repayment.price|currency:repayment.coin+' '}}</td>\n                        <td>{{repayment.total|currency:repayment.coin+' '}}</td>\n                    </tr>\n                        \n                    </tbody> -->\n                </table>\n            </div>\n        </div>\n    </div>\n</div>\n<dialog #quantity class=\"quantity\">\n    <div class=\"header\">\n        <h2 class=\"title\">Realizar devolución</h2>\n        <button class=\"btn-cerrar-dialog\" (click)=\"cancel(quantityBack)\">x</button>\n    </div>\n    <div class=\"form\" [formGroup]=\"formDevolucion\">\n        <div class=\"form-control\" [ngClass]=\"{'input-on-focus-success':verifyStyleInput(formDevolucion,'quantity_back')&&\n    elementHasFocus[7],'input-on-focus-fail':!verifyStyleInput(formDevolucion,'quantity_back')}\">\n            <label class=\"form-label\" [ngClass]=\"{'label-on-focus-down':\nelementHasFocus[7]&&positionLabel[7],\n'label-on-focus-up':\nelementHasFocus[7]&&!positionLabel[7]}\" [ngStyle]=\"animationLabel(formDevolucion,\n'quantity_back')\">\n                Cantidad a devolver\n            </label>\n            <input formControlName=\"quantity_back\"\n                (focus)=\"isFocused(7,formDevolucion,'quantity_back')\"\n                (focusout)=\"isFocused(7,formDevolucion,'quantity_back')\" class=\"form-input\"\n                [ngStyle]=\"styleForeground(formDevolucion,'quantity_back')\"\n                (keypress)=\"validate($event,false)\">\n        </div>\n    </div>\n    <div class=\"form-actions\">\n        <button class=\"form-button btn\"\n            [ngClass]=\"{'enable aceptar':formDevolucion.get('quantity_back')?.value.length>0}\"\n            (click)=\"registrarDevolucion()\">\n           <i class=\"fas fa-truck-loading fa-fw\"></i> &nbsp;&nbsp;REALIZAR DEVOLUCIÓN</button>\n        <button class=\"form-button btn enable\" (click)=\"cancel(quantityBack)\" style=\"color:#f44336\">\n            <i class=\"far fa-times-circle\"></i> &nbsp;&nbsp;CANCELAR</button>\n    </div>\n</dialog>\n<dialog class=\"dialog\" #popup>\n    <i class=\"fa-regular fa-circle-question\"></i>\n    <h3>¿Estas seguro?</h3>\n    <p>Lois datos seran guardados en el sistema</p>\n    <div>\n        <button class=\"form-button btn-save\" (click)=\"acept()\">\n            &nbsp;&nbsp;ACEPTAR</button>\n        <button *ngIf=\"this.popUp?.nativeElement.children[1].textContent === '¿Estás seguro?'\"\n            class=\"form-button btn-cancel\" (click)=\"cancel(popUp)\">\n            &nbsp;&nbsp;CANCELAR</button>\n    </div>\n</dialog>"]},"metadata":{},"sourceType":"module","externalDependencies":[]}