{"ast":null,"code":"import { Columns, PdfMakeWrapper, Table, Txt } from 'pdfmake-wrapper';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"src/app/services/comunicator/comunicator-componets.service\";\nimport * as i2 from \"@angular/router\";\nimport * as i3 from \"../../ventas/service/ventas.service\";\nimport * as i4 from \"../../configuraciones/service/coins.service\";\nimport * as i5 from \"../../configuraciones/service/empresa.service\";\nimport * as i6 from \"@angular/common\";\nfunction ReporteDeVentaComponent_tr_22_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"tr\")(1, \"td\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"td\");\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"td\");\n    i0.ɵɵtext(6);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"td\");\n    i0.ɵɵtext(8);\n    i0.ɵɵpipe(9, \"currency\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(10, \"td\");\n    i0.ɵɵtext(11);\n    i0.ɵɵpipe(12, \"currency\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(13, \"td\");\n    i0.ɵɵtext(14);\n    i0.ɵɵpipe(15, \"currency\");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const reporte_r5 = ctx.$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(reporte_r5.name);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate2(\"\", reporte_r5.names_user, \" \", reporte_r5.last_names_user, \"\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(reporte_r5.sells);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind2(9, 7, reporte_r5.total_sell, reporte_r5.coin + \" \"));\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind2(12, 10, reporte_r5.costos, reporte_r5.coin + \" \"));\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind2(15, 13, reporte_r5.total_sell - reporte_r5.costos, reporte_r5.coin + \" \"));\n  }\n}\nfunction ReporteDeVentaComponent_tr_23_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"tr\")(1, \"td\", 9);\n    i0.ɵɵtext(2, \"No hay ventas realizadas el dia de hoy\");\n    i0.ɵɵelementEnd()();\n  }\n}\nfunction ReporteDeVentaComponent_tr_38_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"tr\")(1, \"td\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"td\");\n    i0.ɵɵtext(4);\n    i0.ɵɵpipe(5, \"currency\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"td\");\n    i0.ɵɵtext(7);\n    i0.ɵɵpipe(8, \"currency\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"td\");\n    i0.ɵɵtext(10);\n    i0.ɵɵpipe(11, \"currency\");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(ctx_r2.calcularTotales().sells);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind2(5, 4, ctx_r2.calcularTotales().total_sell, ctx_r2.calcularTotales().coin + \" \"));\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind2(8, 7, ctx_r2.calcularTotales().total_costos, ctx_r2.calcularTotales().coin + \" \"));\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind2(11, 10, ctx_r2.calcularTotales().ganancias, ctx_r2.calcularTotales().coin + \" \"));\n  }\n}\nfunction ReporteDeVentaComponent_tr_39_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"tr\")(1, \"td\", 9);\n    i0.ɵɵtext(2, \"No hay ventas realizadas el dia de hoy\");\n    i0.ɵɵelementEnd()();\n  }\n}\nfunction ReporteDeVentaComponent_tbody_51_tr_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"tr\")(1, \"td\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"td\");\n    i0.ɵɵtext(4);\n    i0.ɵɵpipe(5, \"currency\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"td\");\n    i0.ɵɵtext(7);\n    i0.ɵɵpipe(8, \"currency\");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const coin_r7 = ctx.$implicit;\n    const i_r8 = ctx.index;\n    const ctx_r6 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate2(\"\", coin_r7.name, \" \", coin_r7.symbol, \"\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind2(5, 4, ctx_r6.paysOfCoin[i_r8].transaccion, coin_r7.symbol + \" \"));\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind2(8, 7, ctx_r6.paysOfCoin[i_r8].efectivo, coin_r7.symbol + \" \"));\n  }\n}\nfunction ReporteDeVentaComponent_tbody_51_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"tbody\");\n    i0.ɵɵtemplate(1, ReporteDeVentaComponent_tbody_51_tr_1_Template, 9, 10, \"tr\", 4);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r4 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r4.coins);\n  }\n}\nconst _c0 = function (a0) {\n  return {\n    \"enable\": a0\n  };\n};\nvar pdfFonts = require(\"pdfmake/build/vfs_fonts\"); // fonts provided for pdfmake\n// If any issue using previous fonts import. you can try this:\n// import pdfFonts from \"pdfmake/build/vfs_fonts\";\n// Set the fonts to use\nPdfMakeWrapper.setFonts(pdfFonts);\nexport class ReporteDeVentaComponent {\n  constructor(comunicatorSvc, routes, ventasSvc, coinsSvc, empresaSvc) {\n    this.comunicatorSvc = comunicatorSvc;\n    this.routes = routes;\n    this.ventasSvc = ventasSvc;\n    this.coinsSvc = coinsSvc;\n    this.empresaSvc = empresaSvc;\n    this.result = [];\n    this.date = new Date();\n    this.reportes = [];\n    this.coins = [];\n    this.paysOfCoin = [{\n      transaccion: 0,\n      efectivo: 0\n    }];\n    this.paysOfCoin = [];\n    console.log(this.paysOfCoin);\n  }\n  ngOnInit() {\n    let title = [];\n    let ruta;\n    setTimeout(() => {\n      /* Obtengo la ruta actual y la transformo para obtener el titulo del componente*/\n      ruta = this.routes.url.slice(this.routes.url.slice(1).indexOf('/') + 2);\n      title.push(decodeURI(ruta).toUpperCase()); //añado el titulo al array\n      title.push(\"fas fa-hand-holding-usd fa-fw\"); //aañado el icono del titulo al array\n      this.comunicatorSvc.setTitleComponent(title);\n    });\n    this.data$ = this.ventasSvc.getSellBydate(this.date).subscribe(res => {\n      if (res instanceof Array) this.reportes = res;\n    });\n    this.coinsSvc.getCoins().subscribe(coins => {\n      this.coins = coins;\n      coins.forEach((coin, i) => {\n        this.paysOfCoin.push({\n          efectivo: 0,\n          transaccion: 0\n        });\n        this.ventasSvc.getPaysByDate(this.date, coin.symbol).subscribe(res => {\n          if (res instanceof Array) {\n            res.forEach(pay => {\n              if (pay.type === 'Efectivo') this.paysOfCoin[i].efectivo += Number(pay.mount);else this.paysOfCoin[i].transaccion += Number(pay.mount);\n            });\n          }\n        });\n      });\n    });\n    this.empresaSvc.getBuildings().subscribe(res => {\n      if (res instanceof Array) {\n        this.empresa = res[0];\n      }\n    });\n  }\n  calcularTotales() {\n    let values = {\n      sells: 0,\n      total_sell: 0,\n      total_costos: 0,\n      ganancias: 0,\n      coin: ''\n    };\n    this.reportes.forEach(reporte => {\n      values.sells += Number(reporte.sells);\n      values.total_sell += Number(Number(reporte.total_sell).toFixed(2));\n      values.total_costos += Number(Number(reporte.costos).toFixed(2));\n      values.ganancias += Number(Number(reporte.total_sell - reporte.costos).toFixed(2));\n      values.coin = reporte.coin;\n    });\n    return values;\n  }\n  createPDF() {\n    const pdf = new PdfMakeWrapper();\n    pdf.add(new Columns([new Txt(this.empresa.name).fontSize(12).lineHeight(1.4).end, '']).end);\n    pdf.add(new Columns([new Txt(this.empresa.document_type + ' ' + this.empresa.document_number + '\\n' + 'Dirección: ' + this.empresa.address + '\\n' + 'Télefono:' + this.empresa.phone_number + '\\n' + 'Email: ' + this.empresa.email).fontSize(8).end, '']).end);\n    pdf.add(new Txt('Reporte de venta (' + new Intl.DateTimeFormat('es-CL').format(this.date) + ')').alignment('center').margin([0, 30, 0, 10]).fontSize(10).end);\n    pdf.add(this.createTables());\n    pdf.create().open();\n  }\n  createTables() {\n    return new Table([['Caja', 'Vendedor', 'Ventas realizadas', 'Total en ventas', 'Costos de ventas', 'Ganancias'], ...this.reportes]).end;\n  }\n  ngOnDestroy() {\n    this.data$.unsubscribe();\n  }\n}\nReporteDeVentaComponent.ɵfac = function ReporteDeVentaComponent_Factory(t) {\n  return new (t || ReporteDeVentaComponent)(i0.ɵɵdirectiveInject(i1.ComunicatorComponetsService), i0.ɵɵdirectiveInject(i2.Router), i0.ɵɵdirectiveInject(i3.VentasService), i0.ɵɵdirectiveInject(i4.CoinsService), i0.ɵɵdirectiveInject(i5.EmpresaService));\n};\nReporteDeVentaComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: ReporteDeVentaComponent,\n  selectors: [[\"app-reporte-de-venta\"]],\n  decls: 56,\n  vars: 12,\n  consts: [[1, \"report-title\"], [1, \"table-body\"], [1, \"table-responsive\"], [1, \"table\", \"table-bordered\"], [4, \"ngFor\", \"ngForOf\"], [4, \"ngIf\"], [1, \"form-actions\"], [1, \"form-button\", \"btn\", 3, \"ngClass\", \"click\"], [1, \"fas\", \"fa-print\"], [\"colspan\", \"7\"]],\n  template: function ReporteDeVentaComponent_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵelementStart(0, \"h3\", 0);\n      i0.ɵɵtext(1);\n      i0.ɵɵpipe(2, \"date\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(3, \"div\", 1)(4, \"div\", 2)(5, \"table\", 3)(6, \"thead\")(7, \"tr\")(8, \"th\");\n      i0.ɵɵtext(9, \"Caja\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(10, \"th\");\n      i0.ɵɵtext(11, \"Vendedor\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(12, \"th\");\n      i0.ɵɵtext(13, \"Ventas realizadas\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(14, \"th\");\n      i0.ɵɵtext(15, \"Total en ventas\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(16, \"th\");\n      i0.ɵɵtext(17, \"Costo de venta\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(18, \"th\");\n      i0.ɵɵtext(19, \"Ganancias\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelement(20, \"th\");\n      i0.ɵɵelementEnd()();\n      i0.ɵɵelementStart(21, \"tbody\");\n      i0.ɵɵtemplate(22, ReporteDeVentaComponent_tr_22_Template, 16, 16, \"tr\", 4);\n      i0.ɵɵtemplate(23, ReporteDeVentaComponent_tr_23_Template, 3, 0, \"tr\", 5);\n      i0.ɵɵelementEnd()()()();\n      i0.ɵɵelementStart(24, \"div\", 1)(25, \"div\", 2)(26, \"table\", 3)(27, \"thead\")(28, \"tr\")(29, \"th\");\n      i0.ɵɵtext(30, \"Total ventas realizadas\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(31, \"th\");\n      i0.ɵɵtext(32, \"Total en ventas\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(33, \"th\");\n      i0.ɵɵtext(34, \"Total costos de venta\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(35, \"th\");\n      i0.ɵɵtext(36, \"Total ganancias\");\n      i0.ɵɵelementEnd()()();\n      i0.ɵɵelementStart(37, \"tbody\");\n      i0.ɵɵtemplate(38, ReporteDeVentaComponent_tr_38_Template, 12, 13, \"tr\", 5);\n      i0.ɵɵtemplate(39, ReporteDeVentaComponent_tr_39_Template, 3, 0, \"tr\", 5);\n      i0.ɵɵelementEnd()()()();\n      i0.ɵɵelementStart(40, \"div\", 1)(41, \"div\", 2)(42, \"table\", 3)(43, \"thead\")(44, \"tr\")(45, \"th\");\n      i0.ɵɵtext(46, \"Moneda\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(47, \"th\");\n      i0.ɵɵtext(48, \"Total en transacciones el\\u00E9ctronicas\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(49, \"th\");\n      i0.ɵɵtext(50, \"Total en efectivo\");\n      i0.ɵɵelementEnd()()();\n      i0.ɵɵtemplate(51, ReporteDeVentaComponent_tbody_51_Template, 2, 1, \"tbody\", 5);\n      i0.ɵɵelementEnd()()();\n      i0.ɵɵelementStart(52, \"div\", 6)(53, \"button\", 7);\n      i0.ɵɵlistener(\"click\", function ReporteDeVentaComponent_Template_button_click_53_listener() {\n        return ctx.createPDF();\n      });\n      i0.ɵɵelement(54, \"i\", 8);\n      i0.ɵɵtext(55, \"\\u00A0\\u00A0IMPRIMIR\");\n      i0.ɵɵelementEnd()();\n    }\n    if (rf & 2) {\n      i0.ɵɵadvance(1);\n      i0.ɵɵtextInterpolate1(\"Estad\\u00EDsticas de venta hoy (\", i0.ɵɵpipeBind2(2, 7, ctx.date, \"dd/MM/yyyy\"), \")\");\n      i0.ɵɵadvance(21);\n      i0.ɵɵproperty(\"ngForOf\", ctx.reportes);\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngIf\", ctx.reportes.length < 1);\n      i0.ɵɵadvance(15);\n      i0.ɵɵproperty(\"ngIf\", ctx.reportes.length > 0);\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngIf\", ctx.reportes.length < 1);\n      i0.ɵɵadvance(12);\n      i0.ɵɵproperty(\"ngIf\", ctx.paysOfCoin.length > 0);\n      i0.ɵɵadvance(2);\n      i0.ɵɵproperty(\"ngClass\", i0.ɵɵpureFunction1(10, _c0, ctx.reportes.length > 0));\n    }\n  },\n  dependencies: [i6.NgClass, i6.NgForOf, i6.NgIf, i6.CurrencyPipe, i6.DatePipe],\n  styles: [\".report-title[_ngcontent-%COMP%]{\\n    text-align:center;\\n    margin:0px;\\n    margin-top: 40px;\\n    font-size: 1.6rem;\\n    font-weight: 200;\\n}\\n.table[_ngcontent-%COMP%]{\\n    background-color: white;\\n    color:black;\\n    text-align: center;\\n}\\n.btn[_ngcontent-%COMP%] {\\n    all: unset;\\n    min-width: 70px;\\n    padding: .8rem 1rem;\\n    margin: 2rem;\\n    border-radius: .3rem;\\n    font-size: .8125rem;\\n    text-align: center;\\n    cursor: not-allowed;\\n    outline: 0;\\n    font-size: 1rem;\\n    color: #676d74;\\n    border:1px solid #676d74\\n  }\\n  .enable[_ngcontent-%COMP%]{\\n    color: #03a9f4;\\n    border:1px solid #03a9f4;\\n    cursor: pointer;\\n  }\\n  .enable[_ngcontent-%COMP%]:hover {\\n    background-color: #EBEBEB;\\n  }\\n/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8uL3NyYy9hcHAvY29udGVudC9yZXBvcnRlcy9yZXBvcnRlLWRlLXZlbnRhL3JlcG9ydGUtZGUtdmVudGEuY29tcG9uZW50LmNzcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtJQUNJLGlCQUFpQjtJQUNqQixVQUFVO0lBQ1YsZ0JBQWdCO0lBQ2hCLGlCQUFpQjtJQUNqQixnQkFBZ0I7QUFDcEI7QUFDQTtJQUNJLHVCQUF1QjtJQUN2QixXQUFXO0lBQ1gsa0JBQWtCO0FBQ3RCO0FBQ0E7SUFDSSxVQUFVO0lBQ1YsZUFBZTtJQUNmLG1CQUFtQjtJQUNuQixZQUFZO0lBQ1osb0JBQW9CO0lBQ3BCLG1CQUFtQjtJQUNuQixrQkFBa0I7SUFDbEIsbUJBQW1CO0lBQ25CLFVBQVU7SUFDVixlQUFlO0lBQ2YsY0FBYztJQUNkO0VBQ0Y7RUFDQTtJQUNFLGNBQWM7SUFDZCx3QkFBd0I7SUFDeEIsZUFBZTtFQUNqQjtFQUNBO0lBQ0UseUJBQXlCO0VBQzNCIiwic291cmNlc0NvbnRlbnQiOlsiLnJlcG9ydC10aXRsZXtcbiAgICB0ZXh0LWFsaWduOmNlbnRlcjtcbiAgICBtYXJnaW46MHB4O1xuICAgIG1hcmdpbi10b3A6IDQwcHg7XG4gICAgZm9udC1zaXplOiAxLjZyZW07XG4gICAgZm9udC13ZWlnaHQ6IDIwMDtcbn1cbi50YWJsZXtcbiAgICBiYWNrZ3JvdW5kLWNvbG9yOiB3aGl0ZTtcbiAgICBjb2xvcjpibGFjaztcbiAgICB0ZXh0LWFsaWduOiBjZW50ZXI7XG59XG4uYnRuIHtcbiAgICBhbGw6IHVuc2V0O1xuICAgIG1pbi13aWR0aDogNzBweDtcbiAgICBwYWRkaW5nOiAuOHJlbSAxcmVtO1xuICAgIG1hcmdpbjogMnJlbTtcbiAgICBib3JkZXItcmFkaXVzOiAuM3JlbTtcbiAgICBmb250LXNpemU6IC44MTI1cmVtO1xuICAgIHRleHQtYWxpZ246IGNlbnRlcjtcbiAgICBjdXJzb3I6IG5vdC1hbGxvd2VkO1xuICAgIG91dGxpbmU6IDA7XG4gICAgZm9udC1zaXplOiAxcmVtO1xuICAgIGNvbG9yOiAjNjc2ZDc0O1xuICAgIGJvcmRlcjoxcHggc29saWQgIzY3NmQ3NFxuICB9XG4gIC5lbmFibGV7XG4gICAgY29sb3I6ICMwM2E5ZjQ7XG4gICAgYm9yZGVyOjFweCBzb2xpZCAjMDNhOWY0O1xuICAgIGN1cnNvcjogcG9pbnRlcjtcbiAgfVxuICAuZW5hYmxlOmhvdmVyIHtcbiAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjRUJFQkVCO1xuICB9Il0sInNvdXJjZVJvb3QiOiIifQ== */\"]\n});","map":{"version":3,"mappings":"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","names":["Columns","PdfMakeWrapper","Table","Txt","i0","pdfFonts","require","setFonts","ReporteDeVentaComponent","constructor","comunicatorSvc","routes","ventasSvc","coinsSvc","empresaSvc","Date","transaccion","efectivo","paysOfCoin","console","log","ngOnInit","title","ruta","setTimeout","url","slice","indexOf","push","decodeURI","toUpperCase","setTitleComponent","data$","getSellBydate","date","subscribe","res","Array","reportes","getCoins","coins","forEach","coin","i","getPaysByDate","symbol","pay","type","Number","mount","getBuildings","empresa","calcularTotales","values","sells","total_sell","total_costos","ganancias","reporte","toFixed","costos","createPDF","pdf","add","name","fontSize","lineHeight","end","document_type","document_number","address","phone_number","email","Intl","DateTimeFormat","format","alignment","margin","createTables","create","open","ngOnDestroy","unsubscribe","selectors","decls","vars","consts","template","ctx"],"sourceRoot":"","sources":["/home/luis/Documentos/systems vs code/inventary-system/client/src/app/content/reportes/reporte-de-venta/reporte-de-venta.component.ts","/home/luis/Documentos/systems vs code/inventary-system/client/src/app/content/reportes/reporte-de-venta/reporte-de-venta.component.html"],"sourcesContent":["import { Component } from '@angular/core';\nimport { Router } from '@angular/router';\nimport { Subscription, tap } from 'rxjs';\nimport { ComunicatorComponetsService } from 'src/app/services/comunicator/comunicator-componets.service';\nimport { VentasService } from '../../ventas/service/ventas.service';\nimport { building, coin, pay } from 'src/app/interfaces/interfaces';\nimport { CoinsService } from '../../configuraciones/service/coins.service';\nimport { EmpresaService } from '../../configuraciones/service/empresa.service';\nimport { Columns, Img, PdfMakeWrapper, Table, Txt } from 'pdfmake-wrapper'\nvar pdfFonts = require(\"pdfmake/build/vfs_fonts\"); // fonts provided for pdfmake\n\n// If any issue using previous fonts import. you can try this:\n// import pdfFonts from \"pdfmake/build/vfs_fonts\";\n\n// Set the fonts to use\nPdfMakeWrapper.setFonts(pdfFonts);\n\n@Component({\n  selector: 'app-reporte-de-venta',\n  templateUrl: './reporte-de-venta.component.html',\n  styleUrls: ['./reporte-de-venta.component.css']\n})\nexport class ReporteDeVentaComponent {\n  result: any[] = [];\n  data$!: Subscription\n  date = new Date()\n  reportes: any[] = []\n  coins: coin[] = []\n  paysOfCoin = [{ transaccion: 0, efectivo: 0 }]\n  empresa!: building\n  constructor(private comunicatorSvc: ComunicatorComponetsService,\n    private routes: Router,\n    private ventasSvc: VentasService,\n    private coinsSvc: CoinsService,\n    private empresaSvc: EmpresaService) { this.paysOfCoin = []; console.log(this.paysOfCoin) }\n  ngOnInit() {\n    let title: string[] = [];\n    let ruta;\n    setTimeout(() => {\n      /* Obtengo la ruta actual y la transformo para obtener el titulo del componente*/\n      ruta = this.routes.url.slice((this.routes.url.slice(1).indexOf('/')) + 2);\n      title.push(decodeURI(ruta).toUpperCase());//añado el titulo al array\n      title.push(\"fas fa-hand-holding-usd fa-fw\");//aañado el icono del titulo al array\n      this.comunicatorSvc.setTitleComponent(title);\n    });\n    this.data$ = this.ventasSvc.getSellBydate(this.date).subscribe(res => {\n      if (res instanceof Array)\n        this.reportes = res\n    })\n    this.coinsSvc.getCoins().subscribe(coins => {\n      this.coins = coins\n      coins.forEach((coin: coin, i: number) => {\n        this.paysOfCoin.push({ efectivo: 0, transaccion: 0 })\n\n        this.ventasSvc.getPaysByDate(this.date, coin.symbol).subscribe(res => {\n          if (res instanceof Array) {\n            res.forEach((pay: pay) => {\n              if (pay.type === 'Efectivo')\n                this.paysOfCoin[i].efectivo += Number(pay.mount)\n              else\n                this.paysOfCoin[i].transaccion += Number(pay.mount)\n            })\n          }\n        })\n      })\n    })\n    this.empresaSvc.getBuildings().subscribe(res => {\n      if (res instanceof Array) {\n        this.empresa = res[0]\n      }\n    })\n  }\n  calcularTotales() {\n    let values = { sells: 0, total_sell: 0, total_costos: 0, ganancias: 0, coin: '' }\n    this.reportes.forEach((reporte: any) => {\n      values.sells += Number(reporte.sells)\n      values.total_sell += Number(Number(reporte.total_sell).toFixed(2))\n      values.total_costos += Number(Number(reporte.costos).toFixed(2))\n      values.ganancias += Number(Number(reporte.total_sell - reporte.costos).toFixed(2))\n      values.coin = reporte.coin\n    })\n    return values\n  }\n  createPDF() {\n    const pdf = new PdfMakeWrapper();\n\n    pdf.add(\n      new Columns([\n        new Txt(this.empresa.name).fontSize(12).lineHeight(1.4).end,\n        ''\n      ]).end)\n    pdf.add(\n      new Columns([\n        new Txt(this.empresa.document_type + ' ' + this.empresa.document_number + '\\n' +\n          'Dirección: ' + this.empresa.address + '\\n' + 'Télefono:' + this.empresa.phone_number + '\\n' +\n          'Email: ' + this.empresa.email).fontSize(8).end,\n        ''\n      ]).end)\n     \n    \n      pdf.add(new Txt('Reporte de venta ('+ \n      new Intl.DateTimeFormat('es-CL').format(this.date)+')').alignment('center')\n      .margin([0,30,0,10]).fontSize(10).end)\n      pdf.add(this.createTables())\n    pdf.create().open()\n  }\n  createTables() {\n    return new Table([\n      ['Caja','Vendedor','Ventas realizadas','Total en ventas','Costos de ventas','Ganancias'],\n      ...this.reportes\n    ]).end\n  }\n\n\n  ngOnDestroy() {\n    this.data$.unsubscribe();\n  }\n}\n","<h3 class=\"report-title\">Estadísticas de venta hoy ({{date|date:'dd/MM/yyyy'}})</h3>\n<div class=\"table-body\">\n    <div class=\"table-responsive\">\n        <table class=\"table table-bordered\">\n            <thead>\n                <tr>\n                    <th>Caja</th>\n                    <th>Vendedor</th>\n                    <th>Ventas realizadas</th>\n                    <th>Total en ventas</th>\n                    <th>Costo de venta</th>\n                    <th>Ganancias</th>\n                    <th></th>\n                </tr>\n            </thead>\n\n            <tbody>\n                 <tr *ngFor=\"let reporte of reportes\">\n                    <td>{{reporte.name}}</td>\n                    <td>{{reporte.names_user}} {{reporte.last_names_user}}</td>\n                    <td>{{reporte.sells}}</td>\n                    <td>{{reporte.total_sell|currency:reporte.coin+' '}}</td>\n                    <td>{{reporte.costos|currency:reporte.coin+' '}}</td>\n                    <td>{{reporte.total_sell-reporte.costos|currency:reporte.coin+' '}}</td>\n                </tr>\n                <tr *ngIf=\"reportes.length<1\">\n                    <td colspan=\"7\">No hay ventas realizadas el dia de hoy</td>\n                </tr> \n            </tbody>\n        </table>\n    </div>\n</div>\n<div class=\"table-body\">\n    <div class=\"table-responsive\">\n        <table class=\"table table-bordered\">\n            <thead>\n                <tr>\n                    <th>Total ventas realizadas</th>\n                    <th>Total en ventas</th>\n                    <th>Total costos de venta</th>\n                    <th>Total ganancias</th>\n                </tr>\n            </thead>\n \n            <tbody >\n                <tr *ngIf=\"reportes.length>0\">\n                    <td>{{calcularTotales().sells}}</td>\n                    <td>{{calcularTotales().total_sell|currency:calcularTotales().coin+' '}}</td>\n                    <td>{{calcularTotales().total_costos|currency:calcularTotales().coin+' '}}</td>\n                    <td>{{calcularTotales().ganancias|currency:calcularTotales().coin+' '}}</td>\n                </tr>\n                <tr *ngIf=\"reportes.length<1\">\n                    <td colspan=\"7\">No hay ventas realizadas el dia de hoy</td>\n                </tr> \n            </tbody>\n        </table>\n    </div>\n</div>\n<div class=\"table-body\">\n    <div class=\"table-responsive\">\n        <table class=\"table table-bordered\">\n            <thead>\n                <tr>\n                    <th>Moneda</th>\n                    <th>Total en transacciones eléctronicas</th>\n                    <th>Total en efectivo</th>\n                </tr>\n            </thead>\n\n              <tbody *ngIf=\"paysOfCoin.length > 0\">\n                <tr *ngFor=\"let coin of coins; let i=index\">\n                    <td>{{coin.name}} {{coin.symbol}}</td>\n                    <td >{{paysOfCoin[i].transaccion|currency:coin.symbol+' '}}</td>\n                    <td >{{paysOfCoin[i].efectivo|currency:coin.symbol+' '}}</td>\n                </tr>\n            </tbody>\n        </table>\n    </div>\n</div>\n<div class=\"form-actions\">\n    <button class=\"form-button btn\" (click)=\"createPDF()\"\n    [ngClass]=\"{'enable':reportes.length>0}\">\n        <i class=\"fas fa-print\"></i>&nbsp;&nbsp;IMPRIMIR</button>\n   \n</div>\n   "]},"metadata":{},"sourceType":"module","externalDependencies":[]}