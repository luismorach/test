{"ast":null,"code":"import { __decorate } from \"tslib\";\nimport { Component, ViewChild } from '@angular/core';\nimport { FormControl } from '@angular/forms';\nimport { DinamicInput } from 'src/app/utils/DinamicInput';\nlet DetallesCompraComponent = class DetallesCompraComponent extends DinamicInput {\n  constructor(routes, comunicatorSvc, renderer, route, comprasSvc, proveedoresSvc, usuariosSvc, productosSvc, fb, location, devolucionesSvc) {\n    super();\n    this.routes = routes;\n    this.comunicatorSvc = comunicatorSvc;\n    this.renderer = renderer;\n    this.route = route;\n    this.comprasSvc = comprasSvc;\n    this.proveedoresSvc = proveedoresSvc;\n    this.usuariosSvc = usuariosSvc;\n    this.productosSvc = productosSvc;\n    this.fb = fb;\n    this.location = location;\n    this.devolucionesSvc = devolucionesSvc;\n    this.title = [];\n    this.buy_products = [];\n    this.products = [];\n  }\n  ngOnInit() {\n    setTimeout(() => {\n      /* Obtengo la ruta actual y la transformo para obtener el titulo del componente*/\n      this.ruta = this.routes.url.slice(this.routes.url.slice(1).indexOf('/') + 2, this.routes.url.lastIndexOf('?'));\n      this.title.push(decodeURI(this.ruta).toUpperCase()); //añado el titulo al array\n      this.title.push(\"fas fa-shopping-bag fa-fw\"); //aañado el icono del titulo al array\n      this.comunicatorSvc.setTitleComponent(this.title);\n    });\n    this.route.queryParams.subscribe(params => {\n      this.comprasSvc.getBuy(params['id_buy']).subscribe(res => {\n        if (res instanceof Array) {\n          this.buy = res[0];\n          this.proveedoresSvc.getProvider(this.buy.id_provider).subscribe(res => {\n            if (res instanceof Array) {\n              this.provider = res[0];\n            }\n          });\n          this.usuariosSvc.getUser(this.buy.id_user).subscribe(res => {\n            if (res instanceof Array) {\n              this.user = res[0];\n            }\n          });\n          console.log(params['id_buy']);\n          this.comprasSvc.getProductsBuy(params['id_buy']).subscribe(res => {\n            console.log(res);\n            if (res instanceof Array) {\n              this.buy_products = res;\n              this.buy_products.forEach(buy_product => {\n                this.productosSvc.getProducto(buy_product.id_product).subscribe(res => {\n                  if (res instanceof Array) {\n                    this.products.push(res[0]);\n                  }\n                });\n              });\n            }\n          });\n        }\n      });\n    });\n    this.formDevolucion = this.fb.group({\n      quantity_back: new FormControl('')\n    });\n  }\n  showModal(product, index) {\n    this.indexElementToBack = index;\n    this.renderer.setProperty(this.quantityBack?.nativeElement.children[0].children[0], 'textContent', 'Realizar Devolución (' + product.name + ' ' + product.mark + ' ' + product.model + ')');\n    this.quantityBack?.nativeElement.showModal();\n  }\n  registrarDevolucion() {\n    let content = '';\n    if (Number(this.formDevolucion.get('quantity_back')?.value) > this.buy_products[this.indexElementToBack].quantity_products - this.buy_products[this.indexElementToBack].quantity_back) {\n      content = 'La cantidad a devolver es mayor a la registrada en la compra';\n    } else if (this.products[this.indexElementToBack].exist_quantity - Number(this.formDevolucion.get('quantity_back')?.value) < 0) {\n      content = 'No existe esa cantidad en el almacen, los productos ya han sido vendidos';\n    } else {}\n    let values = {\n      icon: 'fa-regular fa-circle-xmark',\n      title: 'Ocurrió un error inesperado',\n      content: content\n    };\n    this.changeModal(values);\n    this.popUp?.nativeElement.showModal();\n  }\n  calcularTotal() {\n    this.quantityBack?.nativeElement;\n    let total = 0;\n    this.buy_products.forEach(buy_product => {\n      total += buy_product.buy_price * buy_product.quantity_products;\n    });\n    return total;\n  }\n  redirectToComprasRealizadas() {\n    this.location.back();\n  }\n};\n__decorate([ViewChild('quantity', {\n  static: true\n})], DetallesCompraComponent.prototype, \"quantityBack\", void 0);\n__decorate([ViewChild('popup', {\n  static: true\n})], DetallesCompraComponent.prototype, \"popUp\", void 0);\nDetallesCompraComponent = __decorate([Component({\n  selector: 'app-detalles-compra',\n  templateUrl: './detalles-compra.component.html',\n  styleUrls: ['./detalles-compra.component.css']\n})], DetallesCompraComponent);\nexport { DetallesCompraComponent };","map":{"version":3,"mappings":";AAAA,SAASA,SAAS,EAAyBC,SAAS,QAAQ,eAAe;AAS3E,SAAsBC,WAAW,QAAmB,gBAAgB;AACpE,SAASC,YAAY,QAAQ,4BAA4B;AASlD,IAAMC,uBAAuB,GAA7B,MAAMA,uBAAwB,SAAQD,YAAY;EAavDE,YAAoBC,MAAc,EACxBC,cAA2C,EACnCC,QAAmB,EAC3BC,KAAqB,EACrBC,UAA0B,EAC1BC,cAAkC,EAClCC,WAA4B,EAC5BC,YAA8B,EAC9BC,EAAe,EACfC,QAAkB,EAClBC,eAAmC;IAC3C,KAAK,EAAE;IAXW,WAAM,GAANV,MAAM;IAChB,mBAAc,GAAdC,cAAc;IACN,aAAQ,GAARC,QAAQ;IAChB,UAAK,GAALC,KAAK;IACL,eAAU,GAAVC,UAAU;IACV,mBAAc,GAAdC,cAAc;IACd,gBAAW,GAAXC,WAAW;IACX,iBAAY,GAAZC,YAAY;IACZ,OAAE,GAAFC,EAAE;IACF,aAAQ,GAARC,QAAQ;IACR,oBAAe,GAAfC,eAAe;IArBzB,UAAK,GAAa,EAAE;IAIpB,iBAAY,GAAkB,EAAE;IAChC,aAAQ,GAAc,EAAE;EAkBxB;EAEAC,QAAQ;IACNC,UAAU,CAAC,MAAK;MACd;MACA,IAAI,CAACC,IAAI,GAAG,IAAI,CAACb,MAAM,CAACc,GAAG,CAACC,KAAK,CAAE,IAAI,CAACf,MAAM,CAACc,GAAG,CAACC,KAAK,CAAC,CAAC,CAAC,CAACC,OAAO,CAAC,GAAG,CAAC,GAAI,CAAC,EAAE,IAAI,CAAChB,MAAM,CAACc,GAAG,CAACG,WAAW,CAAC,GAAG,CAAC,CAAC;MAChH,IAAI,CAACC,KAAK,CAACC,IAAI,CAACC,SAAS,CAAC,IAAI,CAACP,IAAI,CAAC,CAACQ,WAAW,EAAE,CAAC,CAAC;MACpD,IAAI,CAACH,KAAK,CAACC,IAAI,CAAC,2BAA2B,CAAC,CAAC;MAC7C,IAAI,CAAClB,cAAc,CAACqB,iBAAiB,CAAC,IAAI,CAACJ,KAAK,CAAC;IACnD,CAAC,CAAC;IACF,IAAI,CAACf,KAAK,CAACoB,WAAW,CAACC,SAAS,CAAEC,MAAM,IAAI;MAC1C,IAAI,CAACrB,UAAU,CAACsB,MAAM,CAACD,MAAM,CAAC,QAAQ,CAAC,CAAC,CAACD,SAAS,CAACG,GAAG,IAAG;QACvD,IAAIA,GAAG,YAAYC,KAAK,EAAE;UACxB,IAAI,CAACC,GAAG,GAAGF,GAAG,CAAC,CAAC,CAAC;UACjB,IAAI,CAACtB,cAAc,CAACyB,WAAW,CAAC,IAAI,CAACD,GAAG,CAACE,WAAW,CAAC,CAACP,SAAS,CAACG,GAAG,IAAG;YACpE,IAAIA,GAAG,YAAYC,KAAK,EAAE;cACxB,IAAI,CAACI,QAAQ,GAAGL,GAAG,CAAC,CAAC,CAAC;;UAE1B,CAAC,CAAC;UACF,IAAI,CAACrB,WAAW,CAAC2B,OAAO,CAAC,IAAI,CAACJ,GAAG,CAACK,OAAO,CAAC,CAACV,SAAS,CAACG,GAAG,IAAG;YACzD,IAAIA,GAAG,YAAYC,KAAK,EAAE;cACxB,IAAI,CAACO,IAAI,GAAGR,GAAG,CAAC,CAAC,CAAC;;UAEtB,CAAC,CAAC;UACFS,OAAO,CAACC,GAAG,CAACZ,MAAM,CAAC,QAAQ,CAAC,CAAC;UAC7B,IAAI,CAACrB,UAAU,CAACkC,cAAc,CAACb,MAAM,CAAC,QAAQ,CAAC,CAAC,CAACD,SAAS,CAACG,GAAG,IAAG;YAC/DS,OAAO,CAACC,GAAG,CAACV,GAAG,CAAC;YAChB,IAAIA,GAAG,YAAYC,KAAK,EAAE;cAExB,IAAI,CAACW,YAAY,GAAGZ,GAAG;cACvB,IAAI,CAACY,YAAY,CAACC,OAAO,CAAEC,WAAwB,IAAI;gBACrD,IAAI,CAAClC,YAAY,CAACmC,WAAW,CAACD,WAAW,CAACE,UAAU,CAAC,CAACnB,SAAS,CAACG,GAAG,IAAG;kBACpE,IAAIA,GAAG,YAAYC,KAAK,EAAE;oBACxB,IAAI,CAACgB,QAAQ,CAACzB,IAAI,CAACQ,GAAG,CAAC,CAAC,CAAC,CAAC;;gBAE9B,CAAC,CAAC;cAEJ,CAAC,CAAC;;UAEN,CAAC,CAAC;;MAEN,CAAC,CAAC;IACJ,CAAC,CAAC;IACF,IAAI,CAACkB,cAAc,GAAG,IAAI,CAACrC,EAAE,CAACsC,KAAK,CAAC;MAClCC,aAAa,EAAE,IAAInD,WAAW,CAAC,EAAE;KAClC,CAAC;EACJ;EACAoD,SAAS,CAACC,OAAgB,EAAEC,KAAa;IACvC,IAAI,CAACC,kBAAkB,GAAGD,KAAK;IAC/B,IAAI,CAAChD,QAAQ,CAACkD,WAAW,CAAC,IAAI,CAACC,YAAY,EAAEC,aAAa,CAACC,QAAQ,CAAC,CAAC,CAAC,CAACA,QAAQ,CAAC,CAAC,CAAC,EAChF,aAAa,EAAE,uBAAuB,GAAGN,OAAO,CAACO,IAAI,GAAG,GAAG,GAAGP,OAAO,CAACQ,IAAI,GAAG,GAAG,GAAGR,OAAO,CAACS,KAAK,GAAG,GAAG,CAAC;IACzG,IAAI,CAACL,YAAY,EAAEC,aAAa,CAACN,SAAS,EAAE;EAC9C;EACAW,mBAAmB;IACjB,IAAIC,OAAO,GAAC,EAAE;IAEd,IAAIC,MAAM,CAAC,IAAI,CAAChB,cAAc,CAACiB,GAAG,CAAC,eAAe,CAAC,EAAEC,KAAK,CAAC,GACxD,IAAI,CAACxB,YAAY,CAAC,IAAI,CAACY,kBAAkB,CAAC,CAACa,iBAAiB,GAC3D,IAAI,CAACzB,YAAY,CAAC,IAAI,CAACY,kBAAkB,CAAC,CAACJ,aAAc,EAAE;MAC7Da,OAAO,GAAC,8DAA8D;KACvE,MAAM,IAAK,IAAI,CAAChB,QAAQ,CAAC,IAAI,CAACO,kBAAkB,CAAC,CAACc,cAAc,GAC/DJ,MAAM,CAAC,IAAI,CAAChB,cAAc,CAACiB,GAAG,CAAC,eAAe,CAAC,EAAEC,KAAK,CAAC,GAAI,CAAC,EAAE;MAC5DH,OAAO,GAAC,0EAA0E;KACrF,MAAI;IAGL,IAAIM,MAAM,GAAO;MACfC,IAAI,EAAC,4BAA4B;MACjCjD,KAAK,EAAC,6BAA6B;MACnC0C,OAAO,EAACA;KACT;IACD,IAAI,CAACQ,WAAW,CAACF,MAAM,CAAC;IACxB,IAAI,CAACG,KAAK,EAAEf,aAAa,CAACN,SAAS,EAAE;EACvC;EAEAsB,aAAa;IACX,IAAI,CAACjB,YAAY,EAAEC,aAAa;IAChC,IAAIiB,KAAK,GAAG,CAAC;IACb,IAAI,CAAChC,YAAY,CAACC,OAAO,CAAEC,WAAwB,IAAI;MACrD8B,KAAK,IAAI9B,WAAW,CAAC+B,SAAS,GAAG/B,WAAW,CAACuB,iBAAiB;IAChE,CAAC,CAAC;IACF,OAAOO,KAAK;EACd;EACAE,2BAA2B;IACzB,IAAI,CAAChE,QAAQ,CAACiE,IAAI,EAAE;EACtB;CAED;AAtG0CC,YAAxChF,SAAS,CAAC,UAAU,EAAE;EAAEiF,MAAM,EAAE;AAAI,CAAE,CAAC,6DAA2B;AAC7BD,YAArChF,SAAS,CAAC,OAAO,EAAE;EAAEiF,MAAM,EAAE;AAAI,CAAE,CAAC,sDAA6B;AAXvD9E,uBAAuB,eALnCJ,SAAS,CAAC;EACTmF,QAAQ,EAAE,qBAAqB;EAC/BC,WAAW,EAAE,kCAAkC;EAC/CC,SAAS,EAAE,CAAC,iCAAiC;CAC9C,CAAC,GACWjF,uBAAuB,CAgHnC;SAhHYA,uBAAuB","names":["Component","ViewChild","FormControl","DinamicInput","DetallesCompraComponent","constructor","routes","comunicatorSvc","renderer","route","comprasSvc","proveedoresSvc","usuariosSvc","productosSvc","fb","location","devolucionesSvc","ngOnInit","setTimeout","ruta","url","slice","indexOf","lastIndexOf","title","push","decodeURI","toUpperCase","setTitleComponent","queryParams","subscribe","params","getBuy","res","Array","buy","getProvider","id_provider","provider","getUser","id_user","user","console","log","getProductsBuy","buy_products","forEach","buy_product","getProducto","id_product","products","formDevolucion","group","quantity_back","showModal","product","index","indexElementToBack","setProperty","quantityBack","nativeElement","children","name","mark","model","registrarDevolucion","content","Number","get","value","quantity_products","exist_quantity","values","icon","changeModal","popUp","calcularTotal","total","buy_price","redirectToComprasRealizadas","back","__decorate","static","selector","templateUrl","styleUrls"],"sourceRoot":"","sources":["/home/luis/Documentos/systems vs code/inventary-system/client/src/app/content/compras/detalles-compra/detalles-compra.component.ts"],"sourcesContent":["import { Component, ElementRef, Renderer2, ViewChild } from '@angular/core';\nimport { ActivatedRoute, ParamMap, Router } from '@angular/router';\nimport { ComunicatorComponetsService } from 'src/app/services/comunicator/comunicator-componets.service';\nimport { DinamicTable } from 'src/app/utils/DinamicTable';\nimport { ComprasService } from '../service/compras.service';\nimport { alert, buy, buy_product, product, provider, user } from 'src/app/interfaces/interfaces';\nimport { ProveedoresService } from '../../administracion/proveedores/service/proveedores.service';\nimport { UsuariosService } from '../../administracion/usuarios/service/usuarios.service';\nimport { ProductosService } from '../../productos/productos-en-almacen/service/productos.service';\nimport { FormBuilder, FormControl, FormGroup } from '@angular/forms';\nimport { DinamicInput } from 'src/app/utils/DinamicInput';\nimport { Location } from '@angular/common';\nimport { DevolucionesService} from '../../devoluciones/service/devoluciones.servic';\n\n@Component({\n  selector: 'app-detalles-compra',\n  templateUrl: './detalles-compra.component.html',\n  styleUrls: ['./detalles-compra.component.css']\n})\nexport class DetallesCompraComponent extends DinamicInput {\n  ruta!: string\n  title: string[] = []\n  buy!: buy\n  provider!: provider\n  user!: user\n  buy_products: buy_product[] = []\n  products: product[] = []\n  indexElementToBack!: number\n  formDevolucion!: FormGroup\n  @ViewChild('quantity', { static: true }) quantityBack?: ElementRef;\n  @ViewChild('popup', { static: true }) override popUp?: ElementRef;\n\n  constructor(private routes: Router,\n    private comunicatorSvc: ComunicatorComponetsService,\n    public override renderer: Renderer2,\n    private route: ActivatedRoute,\n    private comprasSvc: ComprasService,\n    private proveedoresSvc: ProveedoresService,\n    private usuariosSvc: UsuariosService,\n    private productosSvc: ProductosService,\n    private fb: FormBuilder,\n    private location: Location,\n    private devolucionesSvc:DevolucionesService) {\n    super()\n  }\n\n  ngOnInit() {\n    setTimeout(() => {\n      /* Obtengo la ruta actual y la transformo para obtener el titulo del componente*/\n      this.ruta = this.routes.url.slice((this.routes.url.slice(1).indexOf('/')) + 2, this.routes.url.lastIndexOf('?'));\n      this.title.push(decodeURI(this.ruta).toUpperCase());//añado el titulo al array\n      this.title.push(\"fas fa-shopping-bag fa-fw\");//aañado el icono del titulo al array\n      this.comunicatorSvc.setTitleComponent(this.title);\n    });\n    this.route.queryParams.subscribe((params) => {\n      this.comprasSvc.getBuy(params['id_buy']).subscribe(res => {\n        if (res instanceof Array) {\n          this.buy = res[0]\n          this.proveedoresSvc.getProvider(this.buy.id_provider).subscribe(res => {\n            if (res instanceof Array) {\n              this.provider = res[0]\n            }\n          })\n          this.usuariosSvc.getUser(this.buy.id_user).subscribe(res => {\n            if (res instanceof Array) {\n              this.user = res[0]\n            }\n          })\n          console.log(params['id_buy'])\n          this.comprasSvc.getProductsBuy(params['id_buy']).subscribe(res => {\n            console.log(res)\n            if (res instanceof Array) {\n\n              this.buy_products = res\n              this.buy_products.forEach((buy_product: buy_product) => {\n                this.productosSvc.getProducto(buy_product.id_product).subscribe(res => {\n                  if (res instanceof Array) {\n                    this.products.push(res[0])\n                  }\n                })\n\n              })\n            }\n          })\n        }\n      })\n    })\n    this.formDevolucion = this.fb.group({\n      quantity_back: new FormControl('')\n    })\n  }\n  showModal(product: product, index: number) {\n    this.indexElementToBack = index\n    this.renderer.setProperty(this.quantityBack?.nativeElement.children[0].children[0],\n      'textContent', 'Realizar Devolución (' + product.name + ' ' + product.mark + ' ' + product.model + ')')\n    this.quantityBack?.nativeElement.showModal()\n  }\n  registrarDevolucion() {\n    let content=''\n   \n    if (Number(this.formDevolucion.get('quantity_back')?.value) >\n      (this.buy_products[this.indexElementToBack].quantity_products -\n        this.buy_products[this.indexElementToBack].quantity_back)) {\n      content='La cantidad a devolver es mayor a la registrada en la compra'\n    } else if ((this.products[this.indexElementToBack].exist_quantity -\n      Number(this.formDevolucion.get('quantity_back')?.value)) < 0) {\n        content='No existe esa cantidad en el almacen, los productos ya han sido vendidos'\n    }else{\n      \n    }\n    let values:alert={\n      icon:'fa-regular fa-circle-xmark',\n      title:'Ocurrió un error inesperado',\n      content:content\n    }\n    this.changeModal(values)\n    this.popUp?.nativeElement.showModal()\n  }\n\n  calcularTotal() {\n    this.quantityBack?.nativeElement\n    let total = 0;\n    this.buy_products.forEach((buy_product: buy_product) => {\n      total += buy_product.buy_price * buy_product.quantity_products\n    })\n    return total\n  }\n  redirectToComprasRealizadas() {\n    this.location.back()\n  }\n\n}\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}